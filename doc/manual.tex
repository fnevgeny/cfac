\documentclass[twoside,a4paper]{refrep}

\usepackage{makeidx}
\usepackage[numbers]{natbib}
\usepackage{xspace}
\usepackage{verbatim}

\usepackage[pdftex,bookmarks,colorlinks,breaklinks]{hyperref}
\hypersetup{linkcolor=blue,citecolor=blue,filecolor=black,urlcolor=blue}

\usepackage{doi}

\usepackage{listings}
\newcommand{\includecode}[2][sh]{\lstinputlisting[language=#1]{#2}}

\settextfraction{1.0}

\newcommand{\facversion}{{1.5.0}\xspace}
\newcommand{\opt}[1]{
  {\textnormal{[}}{#1}\hspace{0.5mm}{\textnormal{]}}}
\newcommand{\var}[1]{\textit{#1}}
\newcommand{\key}[1]{\texttt{#1}}

\newenvironment{dbdesc}{\textbf{Field Description:} \begin{list}
	{:}{\setlength{\labelwidth}{2in}
	   \setlength{\leftmargin}{2in}
	   \setlength{\labelsep}{0.1in}
	   \setlength{\rightmargin}{0.2in}}}
	{\end{list}}
\newenvironment{fundesc}[2]{
	\begin{center}
	\begin{minipage}{\textwidth}
	\subsection*{\key{\textbf{#1}}(\var{#2}):}
	\index{#1}
	\addcontentsline{toc}{subsection}{#1}}
	{\end{minipage}\end{center}}

\newcounter{faq}[section]
\newcommand{\faq}[2]{\stepcounter{faq}
	\begin{minipage}{\textwidth}
	\textbf{Q\arabic{faq}: #1?}\\#2
	\end{minipage}}

\setcounter{tocdepth}{3}

\makeindex

\begin{document}

\title{cFAC \facversion Manual}
\author{Ming Feng Gu}

\date{}

\maketitle

\tableofcontents

\chapter{Overview}
\label{cha:overview}

\section{What Is FAC}
FAC stands for The Flexible Atomic Code. It is an
integrated software package to calculate various atomic radiative and
collisional processes, including energy levels, radiative transition rates,
collisional excitation and 
ionization by electron impact, photoionization, autoionization, radiative
recombination and dielectronic capture.

The atomic structure calculation in FAC is based on the relativistic
configuration interaction with independent particle basis wavefunctions. These
basis wavefunctions are derived from a local central potential, which is
self-consistently determined to represent electronic screening of the nuclear
potential. Relativistic effects are fully taken into account using the Dirac
Coulomb Hamiltonian. Higher order QED effects are included with Breit
interaction in the zero energy limit for the exchanged photon, and hydrogenic
approximations for self-energy and vacuum polarization effects. 
Continuum processes are treated
in the distorted-wave (DW) approximation. Systematic application of the
factorization-interpolation method of \citet{barshalom:1988a} makes the present
code highly efficient for large scale calculations. The details of theoretical
background and computational methods are not discussed in this manual,
instead, they are described in a series of papers which are distributed along
with this package and this manual.

FAC is a step forward to bring detailed atomic model accessible to a wide
community of laboratory and astrophysical plasma diagnostics. Its flexible
interface is designed to be useful even for people without a deep
understanding of the underlying atomic theories. It is also powerful enough
for experienced users to explore the effects of algorithmic choices and
different physical approximations.

FAC is freely distributed in the hope that it will be useful. The author makes
every effort to ensure its correctness. However, he does not guarantee its
fitness to any specific purpose. The author is not responsible for any damage
resulting from the use of this program, including failure to obtain or loss of
tenure. 

\section{Obtain and Install FAC}
\index{Install}
\label{sec:install}
The latest version of FAC is \facversion. It can be obtained from
\textbf{http://sprg.ssl.berkeley.edu/~mfgu/fac}. I can also send a copy to you
through email. Please request to \textbf{mfgu@ssl.berkeley.edu}. It is being
continuously developed at present, so please check regularly to get the newest
version.

Much of the FAC package is written in ANSI C and Fortran 77. It should 
therefore work on any platform with a C and Fortran 77 compilers. However, 
this is only true to the rather simple command parser that comes with FAC,
referred to as SFAC.

Step-by-step instructions for installation can be found in the README file in
the top directory of FAC distribution.

\section{Quick Start}
\label{sec:start}
\subsection{SFAC Interface}
To use SFAC, one passes the
input files to the \verb|sfac| executable on
the command line such as 
\begin{verbatim}
    sfac input.sf
\end{verbatim}
or, one may invoke \verb|sfac| without arguments, in which
case, it reads from \verb|stdin| for inputs, where commands are interpreted
line by line.

Perhaps the quickest way to get familiar with FAC is to inspect the simple
demo scripts in the \verb|demo/| directory in FAC distribution. There
are individual scripts demonstrating the
calculation of energy levels, radiative transition rates, collisional
excitation and ionization cross sections, radiative recombination cross
sections and autoionization rates.

In this section, we look into the details of one of these scripts,
\verb|demo/structure/test.sf| for the calculation of Ne-like iron
energy levels and radiative transition rates between $n = 2$ and $n = 3$
complexes. The following is a duplication of that script.

\lstset{numbers=left,caption=demo/structure/test.sf}
\includecode[sh]{../demo/structure/test.sf}

Line numbers are added for easy reference, they are not part of the script. 
Empty lines are ignored. As is evident from the above listing, all functions
have a naming convention of concatenated capitalized words.
Line 3 set the atomic element to be iron. Line 5 is a comment, which starts
with a \verb|#|. Lines 6--11 specify the electronic configurations to be
included in the calculation. The closed shells specified by the function
\verb|Closed| must be inactive in this calculation. In the \verb|Config|
functions, \verb|2*8| stands for an $n = 2$ complexes with 8 electrons, while
\verb|2*7 3*1| stands for all configurations resulting from excitation of one
electron from $n = 2$ to $n = 3$. For more possibilities in the specification
of electronic configurations, one is referred to Chapter \ref{cha:function}.
Lines 14--21 carry out a Dirac-Fock-Slater self-consistent calculation to
derive a local central potential which represents the electronic screening of
the nuclear potential. In this calculation, the potential is optimized to the
average electron clouds of configurations \verb|n2| and \verb|n3|, since in
FAC, all atomic processes are treated with basis wavefunctions generated from
a single potential. This
results in the potential to be less optimized for \verb|n2| and \verb|n3|
individually. Lines 14 and 21 are used to make a crude correction to the
resulting energy levels due to this effect. The first call to
\verb|ConfigEnergy(0)| will make individual optimization to all configuration
groups. The average energy of each configuration group with these individually 
optimized potential is then calculated and stored. The
second call to \verb|ConfigEnergy(1)| will then recalculate the average energy
of configuration groups under the potential taking into account all
configuration groups. The difference between the two represents the effect of
a less optimized potential, and are used to adjust the final energy levels. If
this procedure is not needed, one can omit lines 14 and 21 in this script. Line
23 sets up the Hamiltonian matrix for levels in $n = 2$ and $n = 3$ complexes,
diagonalize it, and saves to the energy level information in the binary file
\verb|lev.bin|. Line 24 builds an in-memory table of energy levels, which is
used to convert the binary files to their ASCII counterparts in verbose mode,
such as done in Line 25, which converts \verb|lev.bin| to \verb|lev.asc| (the
last argument to \verb|PrintTable| indicates it be done in verbose mode). For
the conversion in simple mode (the last argument is 0), the in-memory table is
not needed, and Line 24 may be omitted. For the difference between the verbose
and simple ASCII files, see Chapter \ref{cha:format}. Line 27 calculates the
E1 oscillator strength and transition rates between configuration groups
\verb|n2| and \verb|n3|, and saves the results in the binary file
\verb|tr.asc.b|. The function \verb|TransitionTable| accepts an optional 4th
integer argument specifying the transition type. A negative integer means
electric multipole and a positive integer for magnetic multipole. The absolute
value of the integer indicates the rank of the multipole. Therefore, $-1$ would
be E1, $+1$ would be M1, etc. Without this argument, the default is E1, as is
done here. Line 28 converts the binary output to an ASCII file in verbose
mode. The exact formats of binary and ASCII files are explained in Chapter
\ref{cha:format}. Here we list the two ASCII files \verb|lev.asc| and
\verb|tr.asc| resulted from this calculation. 

\lstset{numbers=none,basicstyle=\scriptsize,caption=demo/structure/lev.asc}
\includecode[]{../demo/structure/ref/lev.asc}

\lstset{numbers=none,basicstyle=\normalsize,caption=demo/structure/tr.asc}
\includecode[]{../demo/structure/ref/tr.asc}

In file \verb|lev.asc|, the energy, parity, $2J$ ($J$ is the total
angular momentum of the level), and configuration coupling information are
listed. In file \verb|tr.asc|, the upper and lower level indexes, the $2J$
values of these levels, the transition energy, $gf$-values, radiative
decay rates, and the reduced multipole matrix elements are given.

\section*{Acknowledgments}
Throughout the development of this work, the discussion with Ehud Behar, Masao
Sako, Peter Beiersdorfer, Ali Kinkhabwala and Steven Kahn has been very
useful. Some Fortran 77 subroutines were retrieved from Computer Physics
Communications Program Library at
\url{http://www.cpc.cs.qub.ac.uk}.

The original development of this code (during Dec 2000 -- Aug 2003, or prior
to version 1.0.2) was
supported by NASA through Chandra Postdoctoral Fellowship Award Number
PF01-10014 issued by the Chandra X-ray Observatory Center, which is operated
by Smithsonian Astrophysical Observatory for and on behalf of NASA under
contract NAS8-39073. 

Any opinions, findings and conclusions or
recommendations expressed in this manual are those of the author and do not
necessarily reflect the views of the National Aeronautics Space
Administration and/or the Smithsonian Astrophysical Observatory.

\chapter{Description of Output Files}
\label{cha:format}
The primary output files of FAC are in binary format. The I/O functionality
and the conversion from binary to ASCII format are implemented in the source
files \verb|faclib/dbase.h| and \verb|faclib/dbase.c|. In this chapter, we
describe the structure of these files in detail.

\section{Binary Format}
\label{sec:binary}
\index{Binary format}
Presently, FAC produces different types of files. Each type is assigned
a unique integer, which corresponds to a macro define in the file
\verb|faclib/dbase.h|. These types are
\begin{description}
\item[\texttt{DB\_EN = 1}] Energy levels produced by the function
\verb|Structure|. 
\item[\texttt{DB\_TR = 2}] Radiative transition rates produced by
\verb|TransitionTable|.
\item[\texttt{DB\_CE = 3}] Collisional excitation cross sections produced by
\verb|CETable|. 
\item[\texttt{DB\_RR = 4}] Radiative recombination and photoionization cross
sections produced by \verb|RRTable|.
\item[\texttt{DB\_AI = 5}] Autoionization rates produced by \verb|AITable|.
\item[\texttt{DB\_CI = 6}] Collisional ionization cross sections produced by
\verb|CITable|. 
\item[\texttt{DB\_AIM = 10}] Magnetic sublevel autoionization rates and DR
capture strengths produced by \verb|AITableMSub|.
\item[\texttt{DB\_CIM = 11}] Magnetic sublevel collisional ionization cross
  sections produced by \verb|CITableMSub|.
\end{description}

All files have a common structure. It consists of a file header and one or
more data blocks. Each data block is comprised of a data header and one or
more data records. In the following, we show the C definition of all structs
and describe each field in detail. When one field is a pointer, it means that
an array is saved in the database. The pointer points to the memory location
where the data is stored. In versions 1.0.8 or earlier, the value of the
pointer itself is also saved in the file followed by the data stored in the
array. Obviously, the saved pointer itself has no meaning once the program
exits (since it is a memory location). When reading out the data from the
database file, these pointer values should be ignored. In version 1.0.9 or
later, the pointers are no longer saved, and the file IO are rewritten in a
platform independent way, i.e., the structure fields are written and read one
by one, instead of dealing with the structure as an integrated object. This
avoids the different memory padding added by the compilers which may be
different on different machines.

\subsection{\texttt{F\_HEADER}}
\index{F\_HEADER}
\texttt{F\_HEADER} is the file header common to all data files. 

\begin{verbatim}
typedef struct _F_HEADER_ {
  long  tsession;
  int   version;
  int   sversion;
  int   ssversion;
  int   type;
  float atom;
  char  symbol[4];
  int   nblocks;
} F_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long tsession}:] Time stamp when the file is created. This is the
value returned by the C lib function time(0). It is platform dependent. 
\item[\texttt{int version}:] Major version number of FAC.
\item[\texttt{int sversion}:] Minor version number of FAC.
\item[\texttt{int ssversion}:] Release number of FAC.
\item[\texttt{int type}:] Type of the data file.
\item[\texttt{float atom}:] Atomic number.
\item[\texttt{char symbol[4]}:] The first 3 bytes contains a NULL
terminated C string representing the 2-character abbreviation of the atomic
symbol. The 4th byte is either 0 or 1, indicating whether the platform stores
data in little or big endian.
\item[\texttt{int nblocks}:] Number of data blocks in this file.
\end{dbdesc}

\subsection{\texttt{EN\_HEADER}}
\index{EN\_HEADER}
\texttt{EN\_HEADER} is the data header for energy level data blocks.

\begin{verbatim}
typedef struct _EN_HEADER_ {
  long position;
  long length;
  int nele;
  int nlevels;
} EN_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int nlevels}:] Number of levels in this block.
\end{dbdesc}

\subsection{\texttt{EN\_RECORD}}
\index{EN\_RECORD}
\texttt{EN\_RECORD} represents an energy level.

\begin{verbatim}
#define LNCOMPLEX   32
#define LSNAME      24
#define LNAME       56

typedef struct _EN_RECORD_ {
  short p;
  short j;
  int ilev;
  int ibase;
  double energy;
  char ncomplex[LNCOMPLEX];
  char sname[LSNAME];
  char name[LNAME];
} EN_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{LNCOMPLEX}:] The length of array holding the complex name.
\item[\texttt{LSNAME}:] The length of array holding the non-relativistic
configuration name.
\item[\texttt{LNAME}:] The length of array holding the relativistic
configuration array.
\item[\texttt{short p}:] The parity of the level. This parameter was changed
in version 0.7.6, and it becomes $\pm(100\times n + l)$, where $n$ and $l$ are
the principle quantum number and orbital angular number of the valence
electron, and the $\pm$ sign indicates an even ($+$) or odd ($-$) parity state.
\item[\texttt{short j}:] 2 $\times$ the total angular momentum of the
  level. In UTA mode, \texttt{j} is supposed to be the statistical weight
  minus 1 of the UTA level. However, because a \texttt{short} variable is
  sometimes insufficient to store that value, the code stores it in
  \texttt{ibase} instead. In this case, \texttt{j} is always $-1$.
\item[\texttt{int ilev}:] The index of the level.
\item[\texttt{int ibase}:] The index of the base level. The base level
  obtained by peeling off the valence electron, and the resulting levels must
  be present in the same level file. Other wise, its value is -1. It is not
  always possible to determine the base level, e.g., when the valence orbital
  is occupied by more than one electrons. In such cases, \texttt{ibase} is
  also -1. The value of \texttt{ibase} is primarily used in dealing with DR
  and RE rates, where it may help the distinguish different resonance channels
  and facilitate easy extrapolation. This variable is only added in version
  FAC 1.0.4. So these later versions are not compatible with the binary
  output of the earlier versions.
\item[\texttt{energy}:] The energy of the level in Hartree.
\item[\texttt{char ncomplex[LNCOMPLEX]}:] The complex name. It is in the format
of \verb|n1*nq1 n2*nq2|$\cdots$, where \verb|n1| and \verb|n2| are the
principle quantum numbers of the shell, \verb|nq1| and \verb|nq2| are the
occupation number of these shells.
\item[\texttt{char sname[LSNAME]}:] The non-relativistic configuration name of
the level. Each non-relativistic shell is denoted by the standard
spectroscopic notation, e.g., \verb|2p2| for 2 electrons in $2p$ shell. Only
open and non-empty shells are given. No coupling information is available in
this name.
\item[\texttt{char name[LNAME]}:] The relativistic configuration name of the
level. Each shell is denoted such that \verb|2p+2(2)| represents 2 electrons in
$2p_{3/2}(J=1)$ and \verb|2p-2(2)| represents 2 electrons in
$2p_{1/2}(J=1)$. The number in the parenthesis is 2 times the total angular
momentum of the coupled shell. Immediately after the parenthesis, there is a
number indicate the $2J$ value when all preceding shells are
coupled. Therefore, \verb|2p+2(2)2 2p-2(2)0| represents a state
$[2p_{3/2}^{2}(J=1) 2p_{1/2}^2(J=1)]J=0$.
\end{dbdesc}

\subsection{\texttt{TR\_HEADER}}
\index{TR\_HEADER}
\texttt{TR\_HEADER} is the data header for the radiative transition data
blocks. 

\begin{verbatim}
typedef struct _TR_HEADER_ {
  long position;
  long length;
  int nele;
  int ntransitions;
  int gauge;
  int mode;
  int multipole;
} TR_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int gauge}:] Gauge used in the calculation. 1 is Coulomb gauge, or
the velocity form in non-relativistic limit. 2 is Babushkin gauge or the
length form.
\item[\texttt{int mode}:] Mode used in the calculation. 0 is fully
relativistic. 1 is non-relativistic approximation for multipole operators.
\item[\texttt{int multipole}:] Multipole type of the transition. Its absolute
value is the rank of the multipole, 1 for dipole, 2 for quadrupole, etc. The
positive sign represents magnetic type and negative sign represents electric type.
\end{dbdesc}

\subsection{\texttt{TR\_RECORD}}
\index{TR\_RECORD}
\texttt{TR\_RECORD} is the for radiative transition data.

\begin{verbatim}
typedef struct _TR_RECORD_ {
  int lower;
  int upper;
  float strength;
} TR_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{int lower}:] The lower level index of the transition.
\item[\texttt{int upper}:] The upper level index of the transition.
\item[\texttt{float strength}:] In version 1.0.6 or older, This is the
  weighted oscillator strength $gf$ of the transition. The weighted radiative
  transition rate is related to $gf$ as (in atomic units):
\begin{equation}
gA = 2\alpha^3 \omega^2 gf,
\end{equation}
where $\alpha$ is the fine structure constant, and $\omega$ is transition
energy in Hartree atomic units. 

In version 1.0.7 or newer, this stores the multipole matrix elements $M$
instead. It is related to the $gf$ value as
\begin{equation}
gf =
\left(2L+1\right)^{-1}\omega\left(\alpha\omega\right)^{2L-2}\left|M\right|^2,
\end{equation}
where $L$ is the multipole rank.
\end{dbdesc}

\subsection{\texttt{TR\_EXTRA}}
\index{TR\_EXTRA}
\texttt{TR\_EXTRA} contains the UTA related transition data, namely, the
transition energy including the UTA shift, the UTA Gaussian width, and the
configuration interaction multiplier. This structure is written to the
\texttt{DB\_TR} file only in UTA mode, which is set by \key{SetUTA()}
function.

\begin{verbatim}
typedef struct _TR_EXTRA_ {
  float energy;
  float sdev;
  float sci;
} TR_EXTRA;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{float energy}:] The transition energy including UTA shift.
\item[\texttt{float sdev}:] The Gaussian standard deviation of the UTA.
\item[\texttt{float sci}:] The configuration interaction multiplier, which
  accounts for the CI within the same non-relativistic configurations.
\end{dbdesc}

\subsection{\texttt{CE\_HEADER}}
\index{CE\_HEADER}
\texttt{CE\_HEADER} is the data header for collisional excitation data blocks.

\begin{verbatim}
typedef struct _CE_HEADER_ {
  long position;
  long length;
  int nele;
  int ntransitions;
  int qk_mode;
  int n_tegrid;
  int n_egrid;
  int egrid_type;
  int n_usr;
  int usr_egrid_type;
  int nparams;
  int pw_type;
  int msub;
  float te0;
  double *tegrid;
  double *egrid;
  double *usr_egrid;
} CE_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int qk\_mode}:] The mode for the calculation of radial
integrals. There are 3 choices for collisional excitation. 0 for EXACT, 1 for
INTERPOLATE, and 2 for FIT. In the EXACT mode, the collision strengths are
calculated at the energy grid specified as is, so the \texttt{egrid} and
\texttt{usr\_egrid} must be the same. In the INTERPOLATE mode, the collision
strengths are calculated at \texttt{egrid}, and interpolated to
\texttt{usr\_egrid}. In the FIT mode, the collision strengths are fitted to an
analytic formula and the parameters are output as well. For collision
strengths of magnetic sublevels, the FIT mode is not implemented.
\item[\texttt{int n\_tegrid}:] Number of points for the transition energy grid.
\item[\texttt{int n\_egrid}:] Number of points for the collision energy grid.
\item[\texttt{int egrid\_type}:] Type of the energy grid. 0 for the incident
electron energy, 1 for scattered electron energy. In the present
implementation, only scattered electron energy grid is supported.
\item[\texttt{int n\_usr}:] Number of points for the user collision energy
grid.
\item[\texttt{int usr\_egrid\_type}:] Type of the user energy grid. 0 for the
incident electron energy, 1 for scattered electron energy. In the present
implementation, only scattered electron energy grid is supported.
\item[\texttt{int nparams}:] Number of parameters in the fitting formula if the
collision strengths are calculated in the FIT mode. At present,
\texttt{nparams} is 4. 
\item[\texttt{int pw\_type}:] Partial wave type for the last summation. 0 for
the incident electron, 1 for the scattered electron.
\item[\texttt{int msub}:] 0 for total collision strength, 1 for magnetic
sublevel specific collision strength.
\item[\texttt{float te0}:] The characteristic transition energy of the 
transition array. This is used for the automatic construction of the 
collision energy grid. The grid has equal space in $\ln$(\texttt{egrid+te0})
if \texttt{egrid\_type = 1}, otherwise, this variable is not used.
\item[\texttt{double *tegrid}:] The transition energy grid, the number of
elements is given by \texttt{n\_tegrid}.
\item[\texttt{double *egrid}:] The energy grid, the number of elements is
given by \texttt{n\_egrid}.
\item[\texttt{double *usr\_egrid}:] The user energy grid, the number of
elements is given by \texttt{n\_usr}.
\end{dbdesc}

\subsection{\texttt{CE\_RECORD}}
\index{CE\_RECORD}
\texttt{CE\_RECORD} is for collisional excitation data.

\begin{verbatim}
typedef struct _CE_RECORD_ {
  int lower;
  int upper;
  int nsub;
  float bethe;
  float born[2];
  float *params;
  float *strength;
} CE_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{int lower}:] The lower level index.
\item[\texttt{int upper}:] The upper level index.
\item[\texttt{int nsub}:] Number of magnetic sublevel transitions. Because of
time reversal symmetry, $\sigma_{m_1\to m_2}=\sigma_{-m_1\to -m_2}$, only cross
sections with $m_1 <= 0$ are tabulated.
\item[\texttt{float bethe}:] The Bethe coefficients in the first-Born
approximation. It is the logarithmic coefficients at high energies. If
\texttt{bethe[0]}$<0$, it is a spin forbidden transition. Otherwise, it is
either a optical-allowed transition or other multipole-allowed transitions.
\item[\texttt{float born[2]}:] The Born limit of the collision strengths at
high energies, which is
\begin{eqnarray}
x &=& \frac{E_0}{E_{th}} \nonumber\\
\Omega &=& b_0\ln(x) + b_1,
\end{eqnarray}
where $b_0$ is given by \texttt{bethe}, if it is an allowed transition. The
parameter $b_1$ is calculated at an energy given by $b_2$, which is chosen to
be very high, about $10^{2}E_{th}$ or higher.
For spin forbidden transitions, $b_0 = 0$. $b_1$, $b_2$ are stored in the array
\texttt{born[2]}. These numbers are useful to extrapolate the collision
strengths to high energies with correct asymptotic behavior.
\item[\texttt{float *params}:] Parameters for the fitting formula, if the
fitting mode is used. The number of elements is given by \texttt{nparams} in
\texttt{CE\_HEADER}. In the present implementation, different fitting formulae
are used for allowed and forbidden transitions. The number of parameters is 4
in all cases. The FIT mode is not robust, avoid using it.

For dipole and higher multipole allowed transitions, the
collision strength $\Omega$ is given by
\begin{eqnarray}
x &=& \frac{E_0}{E_{th}} \nonumber\\
\Omega &=& p_0\left(\frac{1}{x}\right)^{p_1} + 
p_2\left(1-\frac{1}{x}\right)^{p_3} + b\ln x,
\end{eqnarray}
where $E_0$ is the energy of the incident electron, $E_{th}$ is the transition
threshold, $p_0$, $p_1$, $p_2$ and $p_4$ are four parameters, and $b$ is the
Bethe coefficient, which is 0 for non-dipole transitions.

For forbidden transitions, the collision strength is given by
\begin{eqnarray}
\gamma &=& -2.0 + p_1\frac{1}{p_3+x} + 
p_2\left(\frac{1}{p_3+x}\right)^2\nonumber\\
\Omega &=& p_0x^\gamma.
\end{eqnarray}

The FIT mode only applies to the calculation of total cross sections. For
magnetic sublevel cross sections, \texttt{params} has \texttt{nsub} elements,
which are the ratios of magnetic sublevel collision strengths to the total
collision strength at high energy limit for allowed transitions. For forbidden
transitions, these numbers are all 0.

\item[\texttt{float *stregnth}:] Collision stregnth on the user energy
grid. The number of elements is given by \texttt{n\_usr} in
\texttt{CE\_HEADER}. It is related to the excitation cross section as (in
atomic units):
\begin{equation}
\sigma = \frac{\pi}{k_0^2g_0}\Omega,
\end{equation}
where $g_0$ is the statistical weight of the initial state, and $k_0$ is the
kinetic momentum of the incident electron. The number of elements in this
array is \texttt{nsub}$\times$\texttt{n\_usr}.
\end{dbdesc}

\subsection{\texttt{RR\_HEADER}}
\index{RR\_HEADER}
\texttt{RR\_HEADER} is the data header for radiative recombination and
photoionization data blocks.

\begin{verbatim}
typedef struct _RR_HEADER_ {
  long position;
  long length;
  int nele;
  int ntransitions;
  int qk_mode;
  int multipole;
  int n_tegrid;
  int n_egrid;
  int egrid_type;
  int n_usr;
  int usr_egrid_type;
  int nparams;
  double *tegrid;
  double *egrid;
  double *usr_egrid;
} RR_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int qk\_mode}:] The mode for the calculation of radial
integrals. There are 3 choices at present. 0 for EXACT, 1 for INTERPOLATE, and
2 for FIT, similar to collisional excitation. However, even if the FIT
mode is used, the fitting formula is only valid in the high energy asymptotic
regions. The low energy results should be obtained by interpolation.
\item[\texttt{int multipole}:] Multipole type of the transition. Its absolute
value is the rank of the multipole, 1 for dipole, 2 for quadrupole, etc. The
positive sign for magnetic type and negative sign for electric type. Usually,
only E1 type is relevant for radiative recombination and photoionization.
\item[\texttt{int n\_tegrid}:] Number of points for the transition energy grid.
\item[\texttt{int n\_egrid}:] Number of points for the collision energy grid.
\item[\texttt{int egrid\_type}:] Type of the energy grid. 0 for the incident
photon energy, 1 for photo-electron energy.
\item[\texttt{int n\_usr}:] Number of points for the user collision energy
grid.
\item[\texttt{int usr\_egrid\_type}:] Type of the user energy grid. 0 for the
incident photon energy, 1 for photo-electron energy.
\item[\texttt{int nparams}:] Number of parameters in the fitting formula if the
bound-free oscillator strengths are calculated in the FIT mode. In the present
implementation, \texttt{nparams} is 4.
\item[\texttt{double *tegrid}:] The transition energy grid, the number of
elements is given by \texttt{n\_tegrid}.
\item[\texttt{double *egrid}:] The energy grid, the number of elements is
given by \texttt{n\_egrid}.
\item[\texttt{double *usr\_egrid}:] The user energy grid, the number of
elements is given by \texttt{n\_usr}.
\end{dbdesc}

\subsection{\texttt{RR\_RECORD}}
\index{RR\_RECORD}
\texttt{RR\_RECORD} is for radiative recombination and photoionization data.

\begin{verbatim}
typedef struct _RR_RECORD_ {
  int b;
  int f;
  int kl;
  float *params;
  float *strength;
} RR_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{int b}:] The bound state index.
\item[\texttt{int f}:] The free state index.
\item[\texttt{int kl}:] The orbital angular momentum of the ionized shell for
the dominant wavefunction component.
\item[\texttt{float *params}:] The parameters in the fitting formula for the
bound-free oscillator strength, if the FIT mode is
used. The fitting formula only provides a high energy asymptotic behavior. Low
energy values should be interpolated from the tabulated strengths. The fitting
formula is
\begin{eqnarray}
x &=& \frac{E_e+p_3}{p_3} \nonumber\\
y &=& \frac{1+p_2}{\sqrt{x}+p_2} \nonumber\\
\frac{d(gf)}{dE} &=&
\frac{E_\gamma}{E_e+p_3}p_0x^{-3.5-l+\frac{1}{2}p_1}y^{p_1}, 
\end{eqnarray}
where $E_e$ is the photo-electron energy, $E_\gamma$ is the photon energy,
$E_{th}$ is the ionization threshold, $p_0$, $p_1$, $p_2$, and $p_3$ are the
parameters, and $l$ is the orbital angular momentum of the ionized
shell. The asymptotic behavior represented by the power law only takes into
account the ionization of the dominant basis in the wavefunction
expansion. The result is in atomic unit Hartree$^{-1}$.
\item[\texttt{float *strength}:] The weighted bound-free oscillator strength in
atomic units. It is related to photoionization and radiative recombination as
(in atomic units):
\begin{eqnarray}
\sigma_{PI} &=& 2\pi\alpha\frac{d f}{d E} \nonumber\\
            &=& \frac{2\pi\alpha}{g_i}
		 \frac{1+\alpha^2\varepsilon}{1+\frac{1}{2}\alpha^2 \varepsilon} 
		 \frac{d(gf)}{d E} \nonumber\\
\sigma_{RR} &=& \frac{\alpha^2}{2}\frac{g_i}{g_f}
                \frac{\omega^2}{\varepsilon \left(1+\frac{1}{2}\alpha^2
                  \varepsilon\right)} \sigma_{PI},
\end{eqnarray}
where $\alpha$ is the fine structure constant, $g_i$ and $g_f$ are the
statistical weight of the bound states before and after the photoionization
takes place respectively, $\omega$ is the photon energy, and $\varepsilon$ is
the energy of the ejected photo-electron. The tabulated values are $d(gf)/dE$.
\end{dbdesc}

\subsection{\texttt{AI\_HEADER}}
\index{AI\_HEADER}
\texttt{AI\_HEADER} is the data header for autoionization data blocks.

\begin{verbatim}
typedef struct _AI_HEADER_ {
  long position;
  long length;
  int nele;
  int ntransitions;
  int channel;
  int n_egrid;
  double *egrid;
} AI_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int channel}:] This an identifier to label the autoionization
channel, which does not have specific physical meaning.
\item[\texttt{int n\_egrid}:] The number of points for the Auger electron
energy grid. The autoionization radial integrals are calculated on this grid
and interpolated to the actual discrete energies.
\item[\texttt{double *egrid}:] The energy grid. The number of elements is
given by \texttt{n\_egrid}.
\end{dbdesc}

\subsection{\texttt{AI\_RECORD}}
\index{AI\_RECORD}
\texttt{AI\_RECORD} is for autoionization data.

\begin{verbatim}
typedef struct _AI_RECORD_ {
  int b;
  int f;
  float rate;
} AI_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{int b}:] The bound state index.
\item[\texttt{int f}:] The free state index.
\item[\texttt{float rate}:] The autoionization rate.
\end{dbdesc}

\subsection{\texttt{CI\_HEADER}}
\index{CI\_HEADER}
\texttt{CI\_HEADER} is the data header for collisional ionization data blocks.

\begin{verbatim}
typedef struct _CI_HEADER_ {
  long position;
  long length;
  int nele;
  int ntransitions;
  int qk_mode;
  int n_tegrid;
  int n_egrid;
  int egrid_type;
  int n_usr;
  int usr_egrid_type;
  int nparams;
  int pw_type;
  double *tegrid;
  double *egrid;
  double *usr_egrid;
} CI_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int qk\_mode}:] The mode for the calculation of radial
integrals. At present, there are 3 choices. 3 for CB mode (Coulomb-Born), 4 for
DW mode (distorted-wave), and 5 for BED mode (binary-encounter-dipole). In CB
mode, the radial integrals are obtained by looking up a table of
Coulomb-Born-Exchange results from \citet{golden:1977a,golden:1980a}, which is
very fast. In DW mode, the integrals are calculated using the distorted-wave
approximation, which is very slow. In BED mode, the binary-encounter-dipole
theory of \citet{kim:1994a} is used which makes use of bound-free oscillator
strength of the same transition. This method is also very fast.
\item[\texttt{int n\_tegrid}:] Number of points for the transition energy grid.
\item[\texttt{int n\_egrid}:] Number of points for the collision energy grid.
\item[\texttt{int egrid\_type}:] Type of the energy grid. 0 for the incident
electron energy, 1 for the total energy of scattered and ejected electron.
\item[\texttt{int n\_usr}:]N umber of points for the user collision energy
grid.
\item[\texttt{int usr\_egrid\_type}:] Type of the user energy grid. 0 for the
incident electron energy, 1 for the total energy of scattered and ejected
electrons .
\item[\texttt{int nparams}:] Number of parameters in the fitting formula. The
final collision strength for total ionization cross sections are fitted with a
4 parameter formula.
\item[\texttt{int pw\_type}:] Partial wave type for the last summation. 0 for
the incident electron, 1 for the scattered electron. It is always 0 for
distorted-wave calculation of ionization.
\item[\texttt{double *tegrid}:] The transition energy grid, the number of
elements is given by \texttt{n\_tegrid}.
\item[\texttt{double *egrid}:] The energy grid, the number of elements is
given by \texttt{n\_egrid}.
\item[\texttt{double *usr\_egrid}:] The user energy grid, the number of
elements is given by \texttt{n\_usr}.
\end{dbdesc}

\subsection{\texttt{CI\_RECORD}}
\index{CI\_RECORD}
\texttt{CI\_RECORD} is for collisional ionization data.

\begin{verbatim}
typedef struct _CI_RECORD_ {
  int b;
  int f;
  int kl;
  float *params;
  float *strength;
} CI_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{int b}:] The bound state index.
\item[\texttt{int f}:] The free state index.
\item[\texttt{int kl}:] The orbital angular momentum of the ionized shell for
the dominant wavefunction component.
\item[\texttt{float *params}:] The parameters in the fitting formula for the
collision strength. The number of elements is given by \texttt{nparams} in
\texttt{CI\_HEADER}, which is 4. The formula used is
\begin{eqnarray}
x &=& \frac{E_0}{E_{th}} \nonumber\\
y &=& 1-\frac{1}{x} \nonumber\\
\Omega &=& p_0\ln x + p_1y^2 + p_2\frac{1}{x}y + p_3\frac{1}{x^2}y,
\end{eqnarray}
where $E_0$ is the energy of the incident electron, $E_{th}$ is the ionization
threshold, $p_0$, $p_1$, $p_2$, and $p_3$ are the four parameters. The
parameter $p_0$ is actually obtained from the bound-free oscillator strength,
which is more reliable than one would get by fitting the calculated collision strengths.
\item[\texttt{float *strength}:] The collision strength for ionization. It is
related to the ionization cross section as (in atomic units):
\begin{equation}
\sigma = \frac{1}{k_0^2g_0}\Omega,
\end{equation}
where ${k_0}$ is the kinetic momentum of the incident electron, and $g_0$ is
the statistical weight of the initial state. The missing of the factor $\pi$
as compared to the formula for collisional excitation is due to the different
normalization for bound and free states.
\end{dbdesc}

\subsection{\texttt{AIM\_HEADER}}
\index{AIM\_HEADER}
\begin{verbatim}
typedef struct _AIM_HEADER_ {
  long int position;
  long int length;
  int nele;
  int ntransitions;
  int channel;
  int n_egrid;
  double *egrid;
} AIM_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int channel}:] This an identifier to label the autoionization
channel, which does not have specific physical meaning.
\item[\texttt{int n\_egrid}:] The number of points for the Auger electron
energy grid. The autoionization radial integrals are calculated on this grid
and interpolated to the actual discrete energies.
\item[\texttt{double *egrid}:] The energy grid. The number of elements is
given by \texttt{n\_egrid}.
\end{dbdesc}

\subsection{\texttt{AIM\_RECORD}}
\index{AIM\_RECORD}
\begin{verbatim}
typedef struct _AIM_RECORD_ {
  int b;
  int f;
  int nsub;
  float *rate;
} AIM_RECORD;
\end{verbatim}
\begin{dbdesc}
\item[\texttt{int b}:] The bound state index.
\item[\texttt{int f}:] The free state index.
\item[\texttt{int nsub}:] The number of entries in array \texttt{rate}. It is
twice the number of transitions tabulated, because both autoionization and DR
capture strength need to be stored. 
\item[\texttt{float *rate}:] An array containing magnetic sublevel
autoionization rates and DR capture strength. Suppose $A(M_1,M_2)$ represents
autoionization rate from $M_1$ sublevel of \texttt{b} to $M_2$ sublevel of
\texttt{f}, and $R(M_1,M_2)$ is capture strength from $M_2$ sublevel of
\texttt{f} to $M_1$ sublevel of \texttt{b}. Then the array \texttt{rate} is
generated in the order consistent with the following code:
\begin{verbatim}
t = 0
for (M1 = -J1; M1 <= 0; M1++) {
  for (M2 = -J2; M2 <= J2; M2++) {
     rate[t++] = A(M1,M2);
     rate[t++] = R(M1,M2);
  }
}
\end{verbatim}
Due to axial symmetry, values for $M_1 > 0$ can be obtained from those with
$M_1 \le 0$.
\end{dbdesc}

\subsection{\texttt{CIM\_HEADER}}
\index{CIM\_HEADER}
\texttt{CIM\_HEADER} is the data header for magnetic sublevel collisional
ionization data blocks. 

\begin{verbatim}
typedef struct _CIM_HEADER_ {
  long position;
  long length;
  int nele;
  int ntransitions;
  int n_egrid;
  int egrid_type;
  int n_usr;
  int usr_egrid_type;
  double *egrid;
  double *usr_egrid;
} CIM_HEADER;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{long position}:] The number of bytes from the beginning of the
file to the place where this data block starts.
\item[\texttt{long length}:] Number of bytes in this data block, excluding the
length of the header.
\item[\texttt{int nele}:] Number of electrons in the ion for this block.
\item[\texttt{int ntransitions}:] Number of transitions in this block.
\item[\texttt{int n\_egrid}:] Number of points for the collision energy grid.
\item[\texttt{int egrid\_type}:] Type of the energy grid. 0 for the incident
electron energy, 1 for the total energy of scattered and ejected electron.
\item[\texttt{int n\_usr}:]N umber of points for the user collision energy
grid.
\item[\texttt{int usr\_egrid\_type}:] Type of the user energy grid. 0 for the
incident electron energy, 1 for the total energy of scattered and ejected
electrons .
\item[\texttt{double *tegrid}:] The transition energy grid, the number of
elements is given by \texttt{n\_tegrid}.
\item[\texttt{double *egrid}:] The energy grid, the number of elements is
given by \texttt{n\_egrid}.
\item[\texttt{double *usr\_egrid}:] The user energy grid, the number of
elements is given by \texttt{n\_usr}.
\end{dbdesc}

\subsection{\texttt{CIM\_RECORD}}
\index{CIM\_RECORD}
\texttt{CIM\_RECORD} is for magnetic sublevel collisional ionization data.

\begin{verbatim}
typedef struct _CIM_RECORD_ {
  int b;
  int f;
  int nsub;
  float *strength;
} CIM_RECORD;
\end{verbatim}

\begin{dbdesc}
\item[\texttt{int b}:] The bound state index.
\item[\texttt{int f}:] The free state index.
\item[\texttt{int nusb}:] The number of sublevel transitions in the
  \texttt{strength} array. 
\item[\texttt{float *strength}:] The magnetic sublevel collision strength for
  ionization. It is related to the ionization cross section as (in atomic
  units): 
\begin{equation}
\sigma = \frac{1}{k_0^2}\Omega,
\end{equation}
where ${k_0}$ is the kinetic momentum of the incident electron. The different
magnetic sublevel transitions are arranged in the order similar to those for
excitation, i.e., $-J_i\to -J_f$, $-J_i\to -J_f+1$, $\cdots$, $-J_i\to J_f$,
$-J_i+1\to -J_f$, $-J_i+1\to -J_f+1$, $\cdots$, $-J_i+1\to J_f$,
$\cdots$. Only the cross sections with $M_i \le 0$ are included, since those
with $M_i \ge 0$ can be obtained using time reversal symmetry.

\end{dbdesc}




\section{ASCII Format}
\index{ASCII Format}
FAC provides functions to convert the binary output to ASCII files. There are
two types of ASCII formats, a simple translation of binary files and a more
verbose version that adds more derived information for the sake of
convenience. If the ASCII files are created to be human-readable, the
verbose form should be used.

In the simple form, the contents of binary files are converted to ASCII format
as is. No additional information is added. All physical values are in atomic
units as is in binary files. The different byte-order used by different
platforms are taken into account automatically. Therefore, it is possible to
create the binary files on a little endian machine (probably faster), then
convert them to ASCII format on a slower big endian machine.

In the verbose form, the more common units of physical quantities are
used. Specifically, s$^{-1}$ for transition rates, 10$^{-20}$ cm$^2$ for cross
sections, and eV for energies. For data files other than \texttt{DB\_EN} type,
the energies and angular momenta of the levels involved in the processes are
not included in the binary version. In the verbose form of corresponding ASCII
files, this information is added by looking up in the energy level
table. Also, for \texttt{DB\_TR} files, not only matrix elements, but also
$gf$ values and radiative transition rates are tabulated. For \texttt{DB\_CE}
and \texttt{DB\_CI}, cross
sections are tabulated along with the collision strengths. For \texttt{DB\_RR},
radiative recombination and photoionization cross sections are tabulated along
with the bound-free differential $gf$ values. For \texttt{DB\_AI}, the energy
integrated dielectronic capture strengths (in unit of 10$^{-20}$ eV cm$^2$)
are tabulated in addition to the autoionization rates.

In the following sections, a portion of each type of database file in the
verbose form is listed and significant fields explained. The lines start with
a ``\verb|#|'' are the added explanation, which are not part of the output
file. These files are generated with the scripts in the \texttt{demo/}
directory come with FAC.

\subsection{\texttt{DB\_EN}}
\index{DB\_EN}
\begin{verbatim}
# version numbers
FAC 1.0.4
# binary order used in the binary file
Endian	= 0
# time stamp when the file was created.
TSess	= 1020438482
# database type
Type	= 1
# this file is in verbose form
Verbose	= 1
# atomic symbol and atomic number
Fe Z	= 26.0
# number of data blocks in this file
NBlocks	= 1
# the index and the absolute energy of the ground state
E0	= 0, -3.12494784E+04

# data block begins
# number of electron for the states in this block
NELE	= 10
# number of levels in this block
NLEV	= 37
  ILEV  IBASE    ENERGY       P   VNL 2J
     0     -1  0.00000000E+00 0   201  0 1*2 2*8      2p6      2p+4(0)0 
     1     -1  7.23810448E+02 1   300  4 1*2 2*7 3*1  2p5 3s1  2p+3(3)3 3s+1(1)4 
     2     -1  7.25859655E+02 1   300  2 1*2 2*7 3*1  2p5 3s1  2p+3(3)3 3s+1(1)2 
     3     -1  7.36414516E+02 1   300  0 1*2 2*7 3*1  2p5 3s1  2p-1(1)1 3s+1(1)0 
     4     -1  7.37736604E+02 1   300  2 1*2 2*7 3*1  2p5 3s1  2p-1(1)1 3s+1(1)2 
     5     -1  7.54149163E+02 0   301  2 1*2 2*7 3*1  2p5 3p1  2p+3(3)3 3p-1(1)2 
     6     -1  7.57788593E+02 0   301  4 1*2 2*7 3*1  2p5 3p1  2p+3(3)3 3p-1(1)4 
     7     -1  7.59341459E+02 0   301  6 1*2 2*7 3*1  2p5 3p1  2p+3(3)3 3p+1(3)6 
     8     -1  7.60552577E+02 0   301  2 1*2 2*7 3*1  2p5 3p1  2p+3(3)3 3p+1(3)2 
     9     -1  7.62361512E+02 0   301  4 1*2 2*7 3*1  2p5 3p1  2p+3(3)3 3p+1(3)4 
    10     -1  7.67999430E+02 0   301  0 1*2 2*7 3*1  2p5 3p1  2p+3(3)3 3p+1(3)0 
   ......
\end{verbatim}

The column labels by \verb|VNL| is $100\times n + l$, where $n$ and $l$ 
are the principle and orbital angular quantum numbers of the valence 
electron.

\subsection{\texttt{DB\_TR}}
\index{DB\_TR}
\begin{verbatim}
FAC 1.0.7
Endian	= 0
TSess	= 1021577025
Type	= 2
Verbose	= 1
Fe Z	=  26.0
NBlocks	= 1

# the data block begins
NELE	= 10
# number of transitions in this block
NTRANS	= 7
# multipole type of the transition
Multip	= -1
# gauge used in the calculation
Gauge	= 2
# mode used in the radial integral
Mode	= 1
#upper 2J  lower 2J  Delta E     gf            TR rate(1/s)  multipole
     2  2      0  0  7.2587E+02  1.130597E-01  8.616084E+11  1.127617E-01
     4  2      0  0  7.3774E+02  9.944485E-02  7.828559E+11  1.048997E-01
    16  2      0  0  8.0114E+02  9.438239E-03  8.761793E+10 -3.101188E-02
    22  2      0  0  8.1133E+02  6.221187E-01  5.923155E+12 -2.501928E-01
    26  2      0  0  8.2527E+02  2.493449E+00  2.456309E+13  4.966355E-01
    30  2      0  0  8.9415E+02  3.203146E-02  3.704097E+11  5.407792E-02
    32  2      0  0  8.9844E+02  2.652003E-01  3.096259E+12 -1.552313E-01
\end{verbatim}

After version 1.0.8, if the UTA mode is used, the output contains an
additional column after the transition energy, which is the Gaussian standard
deviation of the UTA transition. The $2J$ values in this case are also
redefined to be the statistical weight of the configuration minus 1.

\subsection{\texttt{DB\_CE}}
\index{DB\_CE}
\begin{verbatim}
FAC 0.7.9
Endian	= 0
TSess	= 1021577097
Type	= 3
Verbose	= 1
Fe Z	=  26.0
NBlocks	= 1

# data blocks begin
NELE	= 10
NTRANS	= 36
# mode used in the radial integral
QKMODE	= 0
# number of parameters in the fitting formula (only if QKMODE = 2)
NPARAMS	= 0
# 0 for total collision strength. 1 for magnetic sublevel.
MSUB	= 0
# partial wave summation mode. always 0. 
PWTYPE	= 0
# number of points in the transition energy grid, followed by the grid
NTEGRID	= 2
	  7.24352072E+02
	  9.45773957E+02
# characteristic transition energy used in grid construction.
TE0	=  9.44829120E+02
# energy grid type. 
ETYPE	= 1
# energy grid
NEGRID	= 6
	  4.72414560E+01
	  5.79761386E+02
	  1.39812537E+03
	  2.65576771E+03
	  4.58848260E+03
	  7.55863296E+03
# user energy grid type and the user grid.
UTYPE	= 1
NUSR	= 6
	  4.72414560E+01
	  5.79761386E+02
	  1.39812537E+03
	  2.65576771E+03
	  4.58848260E+03
	  7.55863296E+03
#lower 2J upper 2J Delta E  nsub
    0	 0	    1	 4	 7.2435E+02	1
#The Bethe coefficient and 2 Born coefficients in the Born approximation.
-1.0000E+00  0.0000E+00  0.0000E+00
# if QKMODE = 2, the parameter line is present here.
#user egrid  coll. str.  cross sec.
 4.7241E+01	 1.5347E-03	 2.3789E-01
 5.7976E+02	 9.5137E-04	 8.7207E-02
 1.3981E+03	 5.1906E-04	 2.9211E-02
 2.6558E+03	 2.5016E-04	 8.8294E-03
 4.5885E+03	 1.1322E-04	 2.5376E-03
 7.5586E+03	 5.1291E-05	 7.3523E-04
    0	 0	    2	 2	 7.2639E+02	1
 9.1750E-03 -7.0392E-03  7.2655E-03
 4.7241E+01	 1.8857E-03	 2.9153E-01
 5.7976E+02	 3.7280E-03	 3.4119E-01
 1.3981E+03	 6.3378E-03	 3.5633E-01
 2.6558E+03	 9.4893E-03	 3.3472E-01
 4.5885E+03	 1.2996E-02	 2.9116E-01
 7.5586E+03	 1.6729E-02	 2.3974E-01
 ......
\end{verbatim}

If \texttt{MSUB} = 1, then the data for each transition contains \texttt{nsub}
blocks, representing several $m_i\to m_f$ transitions. Before each block, the
ratio of the magnetic sublevel collision strengths to the total collision
strength at high energy limit is given. Due to the time
reversal symmetry, the cross section for $-m_i \to -m_f$ is the same as that
for $m_i \to m_j$, only the cross sections with $m_i \le 0$ are tabulated in
the order $-J_i\to -J_f$, $-J_i\to -J_f+1$, $\cdots$, $-J_i\to J_f$,
$-J_i+1\to -J_f$, $-J_i+1\to -J_f+1$, $\cdots$, $-J_i+1\to J_f$, $\cdots$.


\subsection{\texttt{DB\_RR}}
\index{DB\_RR}
\begin{verbatim}
FAC 0.7.3
Endian	= 0
TSess	= 1021577047
Type	= 4
Verbose	= 1
Fe Z	=  26.0
NBlocks	= 1

# the data blocks begin
NELE	= 3
NTRANS	= 3
QKMODE	= 2
# multipole type
MULTIP	= -1
# number of parameters in the fitting formula
NPARAMS	= 4
NTEGRID	= 1
	  2.01377924E+03
ETYPE	= 1
NEGRID	= 6
	  1.00688962E+02
	  1.23568529E+03
	  2.97992069E+03
	  5.66042025E+03
	  9.77974833E+03
	  1.61102339E+04
UTYPE	= 1
NUSR	= 6
	  1.00688962E+02
	  1.23568529E+03
	  2.97992069E+03
	  5.66042025E+03
	  9.77974833E+03
	  1.61102339E+04
#bound 2J  free 2J  Delta E    L 
    7	 1	    0	 0	 2.0465E+03	 0
# the parameters in the fitting formula
 3.8124E-02  4.9724E+00  1.2195E+00  2.1768E+03 
#user egrid RR cross sec. PI cross sec. gf
 1.0069E+02	 1.7567E-01	 1.9604E+00	 3.0537E-02
 1.2357E+03	 1.4375E-02	 8.4255E-01	 1.3124E-02
 2.9799E+03	 5.5123E-03	 3.3223E-01	 5.1751E-03
 5.6604E+03	 2.4847E-03	 1.2100E-01	 1.8848E-03
 9.7797E+03	 1.1476E-03	 4.1004E-02	 6.3872E-04
 1.6110E+04	 5.2175E-04	 1.3029E-02	 2.0295E-04
    8	 1	    0	 0	 1.9975E+03	 1
 3.4223E-02  5.3145E+00  1.2206E+00  2.1537E+03 
 1.0069E+02	 1.5214E-01	 1.7781E+00	 2.7697E-02
 1.2357E+03	 8.4472E-03	 5.1024E-01	 7.9480E-03
 2.9799E+03	 2.1814E-03	 1.3407E-01	 2.0885E-03
 5.6604E+03	 6.5910E-04	 3.2509E-02	 5.0639E-04
 9.7797E+03	 2.0448E-04	 7.3672E-03	 1.1476E-04
 1.6110E+04	 6.2231E-05	 1.5624E-03	 2.4338E-05
    9	 3	    0	 0	 1.9810E+03	 1
 6.9754E-02  5.1620E+00  1.2206E+00  2.1350E+03 
 1.0069E+02	 2.9691E-01	 1.7625E+00	 5.4910E-02
 1.2357E+03	 1.6320E-02	 4.9796E-01	 1.5513E-02
 2.9799E+03	 4.1721E-03	 1.2907E-01	 4.0209E-03
 5.6604E+03	 1.2475E-03	 3.0899E-02	 9.6262E-04
 9.7797E+03	 3.8274E-04	 6.9143E-03	 2.1541E-04
 1.6110E+04	 1.1506E-04	 1.4471E-03	 4.5081E-05
\end{verbatim}

\subsection{\texttt{DB\_AI}}
\index{DB\_AI}
\begin{verbatim}
FAC 0.7.3
Endian	= 0
TSess	= 1021577153
Type	= 5
Verbose	= 1
Se Z	=  34.0
NBlocks	= 1

# data blocks begin
NELE	= 10
# number of transitions
NTRANS	= 92
# channel number (no physical meaning)
CHANNE	= 0
# free electron energy grid
NEGRID	= 2
	  3.43213508E+02
	  5.58605513E+02
#bound 2J free 2J  Delta E     AI rate    DC strength
    2	 4    0	 3	 3.8679E+02	 1.3705E+13	 1.0962E+01
    2	 4    1	 1	 3.4322E+02	 1.6996E+11	 3.0642E-01
    3	 0    0	 3	 4.0594E+02	 1.2973E+13	 1.9775E+00
    3	 0    1	 1	 3.6236E+02	 7.9903E+11	 2.7289E-01
    4	 4    0	 3	 4.1845E+02	 2.3652E+11	 1.7487E-01
    4	 4    1	 1	 3.7487E+02	 2.2905E+09	 3.7807E-03
    ......
\end{verbatim}

\subsection{\texttt{DB\_CI}}
\index{DB\_CI}
\begin{verbatim}
FAC 0.7.3
Endian	= 0
TSess	= 1021577194
Type	= 6
Verbose	= 1
Fe Z	=  26.0
NBlocks	= 1

# data blocks begin
NELE	= 10
NTRANS	= 3
QKMODE	= 5
NPARAMS	= 4
PWTYPE	= 0
NTEGRID	= 2
	  1.26072567E+03
	  1.39546596E+03
ETYPE	= 1
NEGRID	= 6
	  6.64047908E+01
	  8.14939607E+02
	  1.96527014E+03
	  3.73307079E+03
	  6.44978485E+03
	  1.06247665E+04
UTYPE	= 1
NUSR	= 8
	  5.00000000E+02
	  9.00000000E+02
	  1.30000000E+03
	  1.70000000E+03
	  2.10000000E+03
	  4.20000000E+03
	  6.00000000E+03
	  8.00000000E+03
#bound 2J  free 2J  Delta E    L
    0	 0	    1	 3	 1.2607E+03	 1
# parameters in the fitting formula
 1.2549E-01  6.7308E-01 -5.4651E-01  7.2856E-01 
#user egrid  coll. str.  cross sec.
 5.0000E+02	 9.0588E-02	 1.9535E+00
 9.0000E+02	 1.5721E-01	 2.7605E+00
 1.3000E+03	 2.1672E-01	 3.2084E+00
 1.7000E+03	 2.6991E-01	 3.4532E+00
 2.1000E+03	 3.1773E-01	 3.5785E+00
 4.2000E+03	 5.0773E-01	 3.5050E+00
 6.0000E+03	 6.1976E-01	 3.2065E+00
 8.0000E+03	 7.1292E-01	 2.8808E+00
    0	 0	    2	 1	 1.2737E+03	 1
 6.3179E-02  3.3088E-01 -2.6847E-01  3.5591E-01 
 5.0000E+02	 4.4336E-02	 9.4904E-01
 9.0000E+02	 7.7083E-02	 1.3454E+00
 1.3000E+03	 1.0639E-01	 1.5671E+00
 1.7000E+03	 1.3263E-01	 1.6894E+00
 2.1000E+03	 1.5624E-01	 1.7529E+00
 4.2000E+03	 2.5023E-01	 1.7233E+00
 6.0000E+03	 3.0577E-01	 1.5791E+00
 8.0000E+03	 3.5203E-01	 1.4205E+00
    0	 0	    3	 1	 1.3955E+03	 0
 5.7526E-02  2.8628E-01 -2.4531E-01  3.1267E-01 
 5.0000E+02	 3.4409E-02	 6.8908E-01
 9.0000E+02	 6.0280E-02	 9.9604E-01
 1.3000E+03	 8.4082E-02	 1.1823E+00
 1.7000E+03	 1.0585E-01	 1.2950E+00
 2.1000E+03	 1.2576E-01	 1.3615E+00
 4.2000E+03	 2.0705E-01	 1.3946E+00
 6.0000E+03	 2.5609E-01	 1.3005E+00
 8.0000E+03	 2.9733E-01	 1.1840E+00
\end{verbatim}

\chapter{SFAC Function Reference}
\label{cha:function}
\index{Functions}
This chapter describes the functions available in the SFAC interface.
In the
documentation of each function, the arguments in brackets are optional,
arguments separated by ``$\mid$'' are alternative forms of calling syntax,
``...'' in the argument list denotes variable number of arguments, and
keyword arguments are indicated by \var{key=arg} pair.

\section{Functions}
\label{sec:fac}
\index{fac}

The module contains the following functions.

\begin{fundesc}{AITable}{fn, b, f\opt{, c}}
Calculate the autoionization rates between the bound configuration group
\var{b} and the free configuration group \var{f}. The results are saved in
file \var{fn}. The optional channel number \var{c} can be supplied as an
identification of the transition array.
\end{fundesc}

\begin{fundesc}{AITableMSub}{fn, b, f\opt{, c}}
Calculate the magnetic sublevel autoionization rates and dielectronic capture
strength between the bound configuration group \var{b} and the free
configuration group \var{f}. The results are saved in file \var{fn}. The
optional channel number \var{c} can be supplied as an identification of the
transition array.
\end{fundesc}

\begin{fundesc}{AppendTable}{fn}
By default, when a new script is executed, existing binary files are
overwritten. If instead the new data should be appended to the file, use 
this function to set the append flag.
\end{fundesc}

\begin{fundesc}{Asymmetry}{fn, s\opt{, m}}
Calculate the photoionization asymmetry parameters for given relativistic
subshells. \var{s} is a string which gives the subshells. It should be in
spectroscopic notation, e.g., '1s' for $1s_{1/2}$, '2p' for $2p_{1/2,3/2}$
shells, '3p-' for $3p_{1/2}$ and '3p+' for $3p_{3/2}$, etc. The optional
\var{m} specifies the maximum multipole expansion, counting in the order E1,
M1, E2, M2, ..., therefore, $m=1$ includes only E1, $m=2$ includes E1 and M1,
etc. Default is $m=1$. The results are stored in file \var{fn}. For each
subshell, the output starts with one line indicating which subshell it is,
its $nlj$ values, the ionization energy, the number of energy points, and the
value of \var{m} used. It is followed by a block, which contains one line for
each energy point and tabulates the electron energy, photon energy, total
photoionization cross section ($10^{-20}$ cm$^2$), cross section for electron
direction perpendicular to that of photon, the total radiative recombination
cross section, the cross section at 90$^\circ$, and the ratio of
$\sigma_\perp$/$\sigma_\parallel$, where $\sigma_\perp$ is the 90$^\circ$
radiative cross section for photons polarized in the direction perpendicular
to the electron direction, and $\sigma_\parallel$ is the 90$^\circ$ cross
section for photons polarized in the direction parallel to the electron
direction. The last piece of data for each subshell are the $B_\lambda$ and
$B_\lambda^\phi$ parameters defined as
\begin{equation}
\frac{d\sigma}{d\Omega}=\frac{\sigma}{4\pi}\left[\sum_{\lambda\ge 0} B_\lambda
  P_{\lambda}(\cos\theta) - \sum_{\lambda\ge 2} \lambda^{-1}(\lambda-1)^{-1}
  B_\lambda^\phi P_{\lambda}^2(\cos\theta)\cos(2\phi)\right],
\end{equation}
where $\sigma$ is the total cross section, $\theta$ is the angle between the
electron and photon directions, $\phi$ is the azimuth angle of polarization
direction of the photon relative to the electron direction.
\end{fundesc}

\begin{fundesc}{AvgConfig}{c}
Setup a mean configuration for the optimization of central potential as
specified by a string \var{c}. The format of the string is the same as in the
function \key{Config}, except that the occupation can be a non-integer number
in this routine. The mean configuration setup by this function is effective
only if the function \key{OptimizeRadial} is called with no
arguments. Otherwise, the configurations given in that function are used to
generate the mean configuration automatically. It is important that this
function be called before \key{OptimizeRadial} and after
\key{ConfigEnergy(0)}, if the later is used.
\end{fundesc}

\begin{fundesc}{BasisTable}{fn\opt{,m}}
Print out a table of basis wavefunctions and mixing coefficients in the file
\var{fn}. If \var{m} is 0, then the basis table for the ordinary atom is
given, otherwise, the basis table for atom in magnetic and electric fields are
given.
\end{fundesc}

\begin{fundesc}{CETable}{fn, low, up}
Calculate the collision strength for the excitation of states in the
configuration group list \var{low} to those in the group list\var{up}. The
results are saved in the file \var{fn}.
\end{fundesc}

\begin{fundesc}{CETableEB}{fn, low, up\opt{, m}}
Calculate the collision strength for the excitation of states in the
configuration group list \var{low} to those in the group list\var{up}, but for
atoms in magnetic and electric fields. The
results are saved in the file \var{fn}. If \var{m} is 0, then incident
electron is assumed to be isotropic, otherwise, cross sections at different
incident directions are calculated.
\end{fundesc}

\begin{fundesc}{CETableMSub}{fn, low, up}
Calculate the magnetic sublevel collision strength for the excitation of
states in the configuration groups \var{low} to those in the groups
\var{up}. The results are saved in the file \var{fn}.
\end{fundesc}

\begin{fundesc}{CITable}{fn, b, f}
Calculate the collision strength for the ionization of states in the bound
configuration groups \var{b} to those in the free configuration groups
\var{f}. The results are saved in the file \var{fn}.
\end{fundesc}

\begin{fundesc}{CITableMSub}{fn, b, f}
Calculate the magnetic sublevel collision strength for the ionization of
states in the bound configuration groups \var{b} to those in the free
configuration groups \var{f}. The results are saved in the file \var{fn}.
\end{fundesc}

\begin{fundesc}{CheckEndian}{\opt{fn}}
Check the byte order of database file \var{fn}. It returns 0 for little endian
and 1 for big endian. If the optional file name \var{fn} is omitted, the
endian for the current platform is returned.
\end{fundesc}

\begin{fundesc}{Closed}{s, ...}
Specify the closed shells in the electronic configurations. It takes variable
number of arguments, each of them is a non-relativistic or relativistic shell
in the spectroscopic notation. e.g., \key{2s} for $2s$ shell, \key{2p-} for
$2p_{1/2}$ shell, and \key{2p+} for $2p_{3/2}$ shell.
\end{fundesc}

\begin{fundesc}{Config}{c, ..., group=g $\mid$ g, c, ...}
Add one or more configurations to the configuration group \var{g}. In the
first form, the group name \var{g} is given as a keyword, while in the second
form, the first argument must be a group name instead of a configuration. It
takes one or more strings for the configuration specification. A configuration
\var{c} is a string comprised of one or more non-relativistic or relativistic
shells in spectroscopic notation separated by white spaces. e.g.,
\key{2[p+]3} is a $2p_{3/2}$ shell with 3 electrons. If a \key{*} is given
instead of the orbital angular momentum symbol, configurations with all
legitimate values are generated. It is also possible to use \key{[s,p,d]} to
indicate that the orbital angular momentum may take $s$, $p$, or $d$
values. For $l > 20$, no spectroscopic symbol is available, it is specified as
[$l$] such as [21,22] for $l$ = 21 and 22 shells. This numerical notation also
works for $l \le 20$ shells, for which spectroscopic symbols \key{s, p, d, f,
g, h, i, k, l, m, n, o, q, r, t, u, v, w, x, y, z} are available. The bracket
for the orbital angular momentum can be omitted if it comprises of a single
character. Otherwise, the bracket must be present. For example, $2p-2$ is
illegal, but $2[p-]2$ is. Each shell may be followed by multiple conditions on
the occupation number, separated by ``;'', e.g., $3*10;3s>0;3p>5$ generate
configurations that have at least 1 electron in the $3s$ and 6 electrons in
the $3p$ shells. The logical relations allowed in conditions include $=$, $>$,
and $<$. 
\end{fundesc}

\begin{fundesc}{ConfigEnergy}{m\opt{, n\opt{, g, ...}}}
This function should be called twice just before (with \var{m} = 0) and after
(with \var{m} = 1) \key{OptimizeRadial} if used. If \key{AvgConfig} is
called, then \key{ConfigEnergy} with \var{m}=0 must be called before that.
The call with \var{m} = 0
performs a radial optimization for the configuration groups given by the list
\var{g}, and calculate the average energy of each configuration under
such potentials. Multiple optimizations are performed if more than one list
are given. If none is given, the optimization are carried out for each
configuration group. If \var{m} = 0, one may also
specify an integer \var{n} to indicate that \key{RefineRadial(n)} should be
called after the optimization. The call with \var{m} = 1 does not accept
additional arguments. It recalculates the average energy of each configuration
under the potential obtained by \key{OptimizeRadial} issued by the user, The
diagonal elements of the Hamiltonian calculated in the \key{Structure} call is
then adjusted by the difference of the two average energies for each
configuration. The purpose of this routine is to remove some of the errors in
the level energies introduced by using a single central potential for all
configurations.
\end{fundesc}

\begin{fundesc}{CorrectEnergy}{fn, nmin $\mid$ ilev, e, nmin}
Correct the energies of certain levels by given amount. This is used if the
exact energy of some levels is critical. In the first form, the indexes and the
energy corrections are listed as two columns in the file \var{fn}. In the
second form, the indexes are given in the Python list \var{ilev}, and the
energy corrections are given in the list \var{e}. Only levels with valence
electron in $n\ge nmin$ are corrected, if these levels are not constructed
with \key{RecStates}. The corrections are given in
units of eV. For the first level in the correction list, the amount is added
to the energies calculated by FAC, and that level is taken as the reference
level for all other entries in the list. The correction energies in the list
\var{e} for these other entries with \var{ilev}$\ge 0$ are the desired energies
relative to the reference level, i.e., they replace the energies calculated by
FAC. However, if \var{ilev}$<0$, then these corrections are also interpreted
as shifts to be added to the energies calculated by FAC.
\end{fundesc}

\begin{fundesc}{CutMixing}{g0, g1\opt{, c}}
For each levels in the group list \var{g0}, eliminate all mixing components
that are not in the group list \var{g1} or the mixing coefficients less than
\var{c}. 
\end{fundesc}

\begin{fundesc}{GetConfigNR}{c, ...}
This functions returns a list of non-relativistic configurations corresponding
to the supplied configuration strings, which may contain wild casts as in the
function \key{Config}. It is useful, e.g., when one wants to know the
non-relativistic configurations of \key{1*2 2*2 3*1}. 
\end{fundesc}

\begin{fundesc}{GetPotential}{fn}
Print the radial potential obtained by \key{OptimizeRadial} to the file
\var{fn}. The file starts with the parameters for the analytic fit the to
potential, $\lambda$ and $a$, in the formula
\begin{equation}
V_0(r) = -\frac{Z}{r} + \frac{N-1}{r}\left(1-\frac{\exp(-\lambda
r)}{1+ar}\right). 
\end{equation}
After that, the mean configuration used to generate the potential is printed
in 3 columns representing the principle quantum number, the relativistic
angular quantum number $\kappa$, and the fractional occupation number
respectively. Finally, the file gives 8 columns which are $i$, $r$, $Z(r)$,
$V(r)$, $V_d(r)$, $V_e(r)$, $V_e^\prime(r)$, and $U(r)$, where $i$ is the index
for the radial grid, $r$ is the radial grid, $Z(r)$ is the nuclear charge at
radius $r$ taking into account the nuclear charge distribution, $V(r)$ is the
optimal potential, $V_d(r)$ is the direct interaction part of the potential,
$V_e(r)$ is the exchange interaction part of the potential, $V_e^\prime(r)$ is
the Slater approximation of the exchange interaction, and $U(r)$ is the
Uehling potential which approximates the vacuum polarization effects.
\end{fundesc}

\begin{fundesc}{Info}{}
Print out the version information of FAC and contact information of the
author. 
\end{fundesc}

\begin{fundesc}{JoinTable}{fn1, fn2, fn}
Join two binary files \var{fn1} and \var{fn2} to produce a single file
\var{fn}. \var{fn1} and \var{fn2} must have been produced on the same
platform, have the same type and for the same element.
\end{fundesc}

\begin{fundesc}{ListConfig}{\opt{fn, g}}
Print the configurations in the list \var{g} to file \var{fn}. If \var{fn} is
not given or if it is ``-'', the results are written to the stdout. If \var{g}
is not given, then all configurations currently defined are printed.
\end{fundesc}

\begin{fundesc}{MemENTable}{fn}
Build an energy level table in the memory for the \texttt{DB\_EN} type file
\var{fn}. This function must be called before any calls to \key{PrintTable}
in verbose mode.
\end{fundesc}

\begin{fundesc}{OptimizeRadial}{\opt{g\opt{, w}}}
Obtain the optimal radial potential based on the mean configuration generated
by the configuration group list \var{g} and the weight \var{w}, or if they are
absent in the call, by the mean configuration specified by \key{AvgConfig}.
\var{g} and \var{w} must be equal length Python lists if both present. \var{g}
is a list of configuration groups, and \var{w} is a list of weights for each
group when generating the mean configuration. If only \var{g} is present, each
configuration group is given an equal weight.
\end{fundesc}

\begin{fundesc}{PrepAngular}{p\opt{, q}}
Precalculate the angular coefficients between states in \var{p} and
\var{q}. \var{p} and \var{q} are lists of configuration groups. If \var{q} is
not present, the angular coefficients are calculated between states in the
\var{p} list. Only $Z^L(\alpha,\beta)$ and $\tilde{a_\alpha}$ coefficients are
calculated. If the Bra and Ket states have the same number of electrons, $Z^L$
is calculated, otherwise $\tilde{a_\alpha}$ is calculated. This routine should
primarily be used when atomic states are constructed with \key{RecStates},
where the angular coefficients between the base states are used many times. It
is therefore more efficient to precalculate these coefficients.
\end{fundesc}

\begin{fundesc}{Print}{args}
Print out the string representation of \var{args}. This function exists to
assist the conversion to SFAC interface, since Python's \key{print} statement
is not converted.
\end{fundesc}

\begin{fundesc}{PrintTable}{fnb, fna\opt{, v}}
Convert the binary database file \var{fnb} to the ASCII file \var{fna}. The
optional argument \var{v} = 1 requires the conversion be done in verbose
mode, otherwise it is done in simple mode. Note that before conversion in
verbose mode is carried out, one must call \key{MemENTable} first.
\end{fundesc}

\begin{fundesc}{RecStates}{fn, b, n}
Construct recombined states by adding a spectator electron with the principle
quantum number \var{n} onto the basis states in the configuration groups
\var{b}. The orbital angular momentum of the spectator electron is set by two
functions \key{SetRecPWLimits} and \key{SetRecSpectator}. The resulting energy
levels are saved in file \var{fn}.
\end{fundesc}

\begin{fundesc}{RefineRadial}{\opt{n\opt{, m}}}
This function may be called after \key{OptimizeRadial}, which performs a
minimization of the total energy of the mean configuration by adjusting the
parameters in the analytic central potential. \var{n} is the number of energy
evaluations allowed in the minimization, and \var{m} controls the print out
during the calculation. Default: \var{n} = 100, \var{m} = 0 (no print out).
\end{fundesc}

\begin{fundesc}{RRMultipole}{fn, b, f\opt{, m}}
Calculate the bound-free multipole matrix elements. Because \key{RRTable}
does not calculate the matrix elements directly, this function exists to
provide such data. The output are written to the file \var{fn} in ASCII
format. The format is described in the header of the file itself. The
remaining arguments are identical to those in \key{RRTable}
\end{fundesc}

\begin{fundesc}{RRTable}{fn, b, f\opt{, m}}
Calculate the bound-free differential oscillator strengths between the bound
configuration groups \var{b} and free groups \var{f}, which are related to
radiative recombination and photoionization cross sections. The optional
multipole type \var{m} is set to -1 (E1) by default. In almost all cases, no
other multipole types should be important. The results are saved in file
\var{fn}. 
\end{fundesc}

\begin{fundesc}{SetAICut}{c}
Set the autoionization rate cutoff threshold in the output. Only
autoionization rates greater than \var{c} a.u. are output. The default is
$10^{-16}$ a.u. or $\sim 4.13$ s$^{-1}$, if this routine is not called. 
\end{fundesc}

\begin{fundesc}{SetAngZCut}{c}
Set the cutoff threshold for the mixing basis in the calculation of recoupling
coefficients. Only the basis functions with mixing coefficients $>$\var{c} are
included. The default is $10^{-6}$ if this routine is not called.
\end{fundesc}

\begin{fundesc}{SetAtom}{asym\opt{, z\opt{, m\opt{,r}}}}
This function set the atomic element to \var{asym}, where \var{asym} is the
standard elemental symbol. The nuclear charge \var{z}, atomic mass \var{m},
and the nucleus radius of the element can be set optionally. If they are not
set, the standard values are used.
\end{fundesc}

\begin{fundesc}{SetBreit}{n}
Set the maximum principle quantum number of the orbitals for which the
Breit interaction should be included in the Hamiltonian. If \var{n} $<$ 0,
then the Breit interaction involving all bound and continuum states is
included. Default is 5.
\end{fundesc}

\begin{fundesc}{SetCEBorn}{e\opt{,x\opt{, x1}}}
\var{e} specifies the asymptotic energy where the plane-wave Born approximation is
expected to be valid, and is used to deduce the constant component of the
collision strength at high energies. If $e > 0$, it is in unit of the
characteristic transition energy of the array. If $e < 0$, then its absolute
value is the energy in unit of eV. $x$ and $x1$
set the energy boundary between the distorted-wave Born approximation and
plane-wave Born approximation for the collisional excitation. If $x > 0$ and
the scattered
electron energy is less than $xE_{b}$, DW method is chosen, where $E_{b}$ is
the binding energy of the electron being excited. 
If $x$ is negative, the switch between DW and PW occurs when the estimated
high partial-wave contributions becomes larger than $-x$ times the low
partial-waves calculated explicitly. If $x=0$, then PW is always used.
default for $x$ is $-0.5$, i.e., use DW when the estimated high partial-wave
contributions represents no more than 50\% of the explicitly calculated low
partial-wave sum. The contributions of high partial waves for monopole and
dipole transitions are calculated with coulomb-bethe approximation, their
cutoff values are treated differently with the switch \var{x1}, whose default
is $-1.0$.
\end{fundesc}

\begin{fundesc}{SetCEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the collision energy grid for collisional excitation. In the first form, the
grid is given by a Python list \var{g}. In the second form, the grid is
constructed with \var{n} points, from \var{e0} to \var{e1}. The energies are
specified for the scattered electron energy, and in units of eV. This routine
does not need to be called. A default is constructed for a given transition
array with 6 points, minimum and maximum energies specified by
\key{SetCEGridLimits}. Calling this routine with \var{n}=0, reset the grid to
system default.
\end{fundesc}

\begin{fundesc}{SetCEGridLimits}{e0, e1}
Set the minimum and maximum collision energy for collisional excitation for
the automatic construction of the grid. They are in units of average threshold
energy of the transition array being considered. The default is 0.05 and 8.0
if this routine is not called.
\end{fundesc}

\begin{fundesc}{SetCELCB}{m}
Set the orbital angular momentum for Coulomb-Bethe approximation.
\end{fundesc}

\begin{fundesc}{SetCELMax}{m}
Set the maximum of orbital angular momentum for the partial-wave expansion in
collisional excitation.
\end{fundesc}

\begin{fundesc}{SetCELQR}{m}
Set the maximum orbital angular momentum for quasi-relativistic approximation
in collisional excitation. The default is 0, i.e., always use
quasi-relativistic approximation.
\end{fundesc}

\begin{fundesc}{SetCEQkMode}{mode}
Set the computation mode for the excitation radial integrals. \var{mode} may
be a string or an integer specifying the mode. These values are listed in the
variable \key{QKMODE}.
\end{fundesc}

\begin{fundesc}{SetCIEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the collision energy grid for collisional ionization. In the first form, the
grid is given by a Python list \var{g}. In the second form, the grid is
constructed with \var{n} points, from \var{e0} to \var{e1}. The energies are
specified for the total energy of the final electrons, and in units of
eV. This routine does not need to be called. A default is constructed for a
given transition array with 6 points, minimum and maximum energies specified
by \key{SetCIEGridLimits}. 
Calling this routine with \var{n}=0, reset the grid to system default.
\end{fundesc}

\begin{fundesc}{SetCIEGridLimits}{e0, e1}
Set the minimum and maximum collision energy for collisional ionization for
the automatic construction of the grid. They are in units of average threshold
energy of the transition array being considered. The default is 0.05 and 8.0
if this routine is not called.
\end{fundesc}

\begin{fundesc}{SetCILCB}{m}
Set the orbital angular momentum for the Coulomb-Bethe approximation in DW
collisional ionization.
\end{fundesc}

\begin{fundesc}{SetCILevel}{m}
Set the level of configuration interaction space. By default, $m=0$, the
configuration space is determined by the configuration groups passed to the
\key{Structure} function. CI can be further refined by the value of $m$. If
$m=-1$, then no CI is included, the Hamiltonian is assumed to be diagonal. If
$m=1$, only CI within the same relativistic configuration is included. If
$m=2$, only CI within the same non-relativistic configuration is included. If
$m=3$, only CI within the same configuration group is included.
\end{fundesc}

\begin{fundesc}{SetCILMax}{m}
Set the maximum orbital angular momentum for the partial-wave expansion in DW
collisional ionization.
\end{fundesc}

\begin{fundesc}{SetCILMaxEject}{m}
Set the maximum orbital angular momentum for the ejected electron in DW
collisional ionization.
\end{fundesc}

\begin{fundesc}{SetCILQR}{m}
Set the orbital angular momentum for quasi-relativistic approximation in DW
collisional ionization.
\end{fundesc}

\begin{fundesc}{SetCITol}{m}
Set the tolerance factor in the partial-wave expansion of DW collisional
ionization. 
\end{fundesc}

\begin{fundesc}{SetCIQkMode}{mode}
Set the computation mode for the ionization radial integrals. \var{mode} may
be a string or an integer specifying the mode. These values are listed in the
variable \key{QKMODE}.
\end{fundesc}

\begin{fundesc}{SetFields}{b, e, a\opt{, m}}
Set the magnetic and electric fields. \var{b} is the magnetic fields in Gauss,
\var{e} is the electric fields in Volts/cm. \var{a} is the angle between the
magnetic and electric fields. If the optional \var{m} is 1, then the
diamagnetic effects is ignored in the Hamiltonian.
\end{fundesc}

\begin{fundesc}{SetHydrogenicNL}{\opt{n,\opt{l}}}
Set the principle quantum number \var{n} and the orbital angular momentum
\var{l}, beyond which, the hydrogenic approximation for the E1 multipole
integrals should be used. If this routine is not called or the argument is not
given, the default is \var{n}=8, and \var{l}=7. 
\end{fundesc}

\begin{fundesc}{SetIEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the ionization threshold energy grid for the collisional ionization. In
the first form, the grid is given by a Python list \var{g}. In the second
form, the grid is constructed with \var{n} points from \var{e0} to
\var{e1}. This routine does not need to be called. A 3 point grid is
constructed according to the transition array being considered by default.
Calling this routine with \var{n}=0, reset the grid to system default.
\end{fundesc}

\begin{fundesc}{SetMaxRank}{k}
Set the maximum rank in the expansion of Slater integrals. The default is 6,
if this routine is not called.
\end{fundesc}

\begin{fundesc}{SetMixCut}{c}
Set cutoff threshold of the mixing basis in the wavefunction. Only the basis
with mixing coefficients greater than \var{c} are included in the wavefunction
expansion. Default is $10^{-5}$.
\end{fundesc}

\begin{fundesc}{SetMS}{nms, sms}
Set flags for normal mass shift and specific mass shift contributions to the
Hamiltonian. 0---disable, 1---enable. Defaults: 1.
\end{fundesc}

\begin{fundesc}{SetOptimizeControl}{t, s, m\opt{, p}}
Set the options for radial potential optimization. \var{t} is the tolerance
for the self-consistent field iteration. \var{s} is the stabilizer for the
iteration, a number from 0 to 1. \var{m} is the maximum number of iterations
allowed. \var{p} 
specifies whether diagnostic information should be printed out during the
optimization. This routine does not need to be called. The default for \var{t}
is $10^{-6}$, \var{s} is determined dynamically according to the
type of ion, \var{m} is 100, and \var{p} is 0 for no printing out of
information. 
\end{fundesc}

\begin{fundesc}{SetOptimizeMaxIter}{m}
Set the maximum itneration in \key{OptimizeRadial}.
\end{fundesc}

\begin{fundesc}{SetOptimizePrint}{m}
Set the printing option in \key{OptimizeRadial}.
\end{fundesc}

\begin{fundesc}{SetOptimizeStabilizer}{m}
Set the stabilizer factor in \key{OptimizeRadial}.
\end{fundesc}

\begin{fundesc}{SetOptimizeTolerance}{m}
Set the tolerance factor in \key{OptimizeRadial}.
\end{fundesc}

\begin{fundesc}{SetPEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the free electron energy grid for photoionization, radiative recombination
and autoionization. In the first form, the grid is given by a Python list
\var{g}. In the second form, the grid is constructed with \var{n} points from
\var{e0} to \var{e1}. The energies are in units of eV. This function does not
need to be called. A 6 point grid is constructed according to the transition
array being considered by default. Calling this function with \var{n}=0 reset
the grid to system default. 
\end{fundesc}

\begin{fundesc}{SetPEGridLimits}{e0, e1}
Set the minimum and maximum collision energy for photoionization and radiative
recombination for the automatic construction of the grid. They are in units of
average threshold energy of the transition array being considered. The default
is 0.05 and 8.0 if this routine is not called.
\end{fundesc}

\begin{fundesc}{SetRadialGrid}{n\opt{, r0\opt{,r1}\opt{,rmin}}}
Set the radial grid properties. \var{n} is the number of radial grid
points. It must be an even number and less than the macro
\key{MAXRP}. \var{r0} specifies the ratio of successive radial points near 
origin, which is approximately logarithmic. \var{r1} specifies the number of
mesh-points per oscillation wavelength for very high-$n$ orbitals at large 
radii. \var{rmin} divided by the nuclear charge is the starting point of the
radial mesh.
\end{fundesc}

\begin{fundesc}{SetRRTEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the transition energy grid for photoionization and radiative
recombination. In the first form, the grid is given by a Python list
\var{g}. In the second form, the grid is constructed with \var{n} points from
\var{e0} to \var{e1}. This routine does not need to be called. For E1 type
transitions, the transition energy does not enter the calculation, a 1-point
grid is constructed by default. for other types of multipoles, a 3-point grid
is constructed. Calling this function with \var{n}=0 reset the grid to system default.
\end{fundesc}

\begin{fundesc}{SetRecPWLimits}{l0, l1}
Set the orbital angular momentum range for the spectator electron in the
recombined states to [\var{l0}, \var{l1}] inclusive. The default is [0, 12].
\end{fundesc}

\begin{fundesc}{SetRecPWOptions}{lmax}
Set maximum orbital angular momentum of the spectator electron in the
recombined states to \var{lmax}. The allowed values are also limited by the
setting of \key{SetRecPWLimits}. The default is 12.
\end{fundesc}

\begin{fundesc}{SetRecQkMode}{mode}
Set the computation mode for the photoionization and radiative recombination
radial integrals. \var{mode} may be a string or an integer specifying the
mode. These values are listed in the variable \key{QKMODE}.
\end{fundesc}

\begin{fundesc}{SetRecSpectator}{nmin\opt{, nfrozen}}
Set the minimum principle quantum numbers \var{nmin} and \var{nfrozen} for the
spectator electron. States with $n > nmin$ are constructed with
\key{RecStates} function, and those with $n > nfrozen$ are treated with frozen
core approximation. Default for both \var{nmin} and \var{nfrozen} are 8.
\end{fundesc}

\begin{fundesc}{SetScreening}{ns\opt{,c\opt{,k}}}
Set the orbital parameters of screening electrons. \var{ns} is a list of
integers which are the principle quantum numbers of the screening
orbitals. The optional \var{c} is the total charge to be screened, whose
default is 1.0. \var{k} is the either 1, $-1$, or 0. If \var{k}=$-1$, then
the \var{l=0} orbitals are used. If \var{k}=0, then the the \var{l}=\var{ns}/2
orbitals are used. If \var{k}=1, then the \var{l}=\var{ns}-1 nodeless orbital
is used. The default is \var{k}=1. This function is usually used when
additional screening charge is desired for the mean configuration generating
the optimal central potential. It is quite experimental, and therefore not
recommended for general use.
\end{fundesc}

\begin{fundesc}{SetSE}{n}
Set the maximum principle quantum number of the orbitals for which the
self-energy correction should be included in the Hamiltonian. Default is 5.
\end{fundesc}

\begin{fundesc}{SetSlaterCut}{k1, k2}
Set the calculation modes of Slater integrals. \var{k1} and \var{k2} are
orbital angular momentum values. When one of the orbitals has $l > k1$, then
exchange integrals are not calculated. When one has $l > k2$, the direct
integrals are evaluated with the multipole moments.
\end{fundesc}

\begin{fundesc}{SetTEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the transition energy grid for collisional excitation. In the first form,
the grid is given by a Python list \var{g}. In the second form, the grid is
constructed with \var{n} points from 
\var{e0} to \var{e1}. This routine does not need to be called. A 3-point grid
is constructed by default. Calling this function with \var{n}=0 reset the grid
to system default. 
\end{fundesc}

\begin{fundesc}{SetTransitionCut}{c}
Set the cutoff threshold for the radiative transition rates output. Only rates
greater than \var{c} times the total decay rate of the upper level is written
to the output file. The default is $10^{-3}$ if this routine is not called.
\end{fundesc}

\begin{fundesc}{SetTransitionGauge}{m}
Set the gauge for radiative transition.
\end{fundesc}

\begin{fundesc}{SetTransitionMaxE}{m}
Set the maximum rank of electric multipole transitions.
\end{fundesc}

\begin{fundesc}{SetTransitionMaxM}{m}
Set the maximum rank of magnetic multipole transitions.
\end{fundesc}

\begin{fundesc}{SetTransitionMode}{m}
Set the mode for the radiative transition.
\end{fundesc}

\begin{fundesc}{SetTransitionOptions}{g, m}
Set the options for the radiative transition calculation. \var{g} is the gauge
to be used, 1 for Coulomb gauge (velocity form) and 2 for Babushkin gauge
(length form, which is the default). \var{m} is the mode for the multipole
integral, 0 for fully relativistic and 1 for non-relativistic approximation
(the default is 1).
\end{fundesc}

\begin{fundesc}{SetUsrCEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the user collision energy grid for collisional excitation. The collision
strengths on this grid are output. It is forced to be same as that set by
\key{SetCEGrid} if the \key{QKMODE} is \key{'exact'}.
\end{fundesc}

\begin{fundesc}{SetUsrCIEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the user collision energy grid for collisional ionization. The collision
strengths on this grid are output. 
\end{fundesc}

\begin{fundesc}{SetUsrPEGrid}{g $\mid$ n\opt{, e0, e1}}
Set the user electron energy grid for photoionization and radiative
recombination. The bound-free differential oscillator
strengths on this grid are output. It is forced to be same as that set by
\key{SetPEGrid} if the \key{QKMODE} is \key{'exact'}.
\end{fundesc}

\begin{fundesc}{SetUTA}{m\opt{, ci}}
Set the flag for configuration average models. If $m=1$, all calculations are
carried out in the configuration average approximation. The radiative
transition rates output contains three additional fields, the transition
energy including the UTA shift,
the Gaussian standard deviation, and the correction to the line strengths due to
the configuration interaction within the same non-relativistic
configurations. If $m=0$, which is the default,
the usual detailed term accounting method is used. This function should be
called in the beginning of the script, before \key{Config} function, since it
disables the angular momentum coupling performed by \key{Config}. The optional
argument \var{ci} indicates whether the configuration interaction correction
factors should be included when reading the \key{DB\_TR} files. These 
correction factors are always calculated in \key{TransitionTable} irrespective
of the value of \var{ci}.
\end{fundesc}

\begin{fundesc}{SetVP}{vp}
Set the flag for vacuum polarization correction to the
Hamiltonian. 0---disable, 1---only include 2nd order term, 2---include the 4th
order term as well. Default is 2.
\end{fundesc}

\begin{fundesc}{SlaterCoeff}{fn, g, a, b}
Calculate the expansion coefficients of the exchange radial integral
in the Coulomb energy of each state in the
configuration list 
\var{g}. The Coulomb energy between electrons of a state can be expanded as
\begin{equation}
E = \sum g_kG^k(\alpha\alpha^\prime,\beta\beta^\prime) + \mbox{direct terms},
\end{equation}
where $\alpha$ and $\alpha^\prime$ are the interacting orbitals in the bra and
ket states, which have the same $l$ values. Because we work in the
$jj$-coupling basis, $\alpha$ and $\alpha^\prime$ may have different $j$
values. The results are stored in the text file \var{fn}. These coefficients
are useful in determining the radiative transition rates from level to average
configurations. \var{a} and \var{b} are the orbital lists contain $\alpha$ and
$\beta$, respectively. They are specified as configuration strings.
The format of the file is as follows. For each state, a line
starts with ``\#'' gives the level index, parity, $2J$-value, and the
configuration label. It is followed by a block of lines. In this block, the first
column is the level index. The 2rd, 3th, and 4th columns are the $n$, $kappa$,
$l$ values of the $\alpha$ orbital. The 5th column is either 0 or 1,
indicating whether $\alpha$ and $\alpha^\prime$ have the same $j$ values. The
6-9th  columns are the corresponding values for the $\beta$ orbital. The 10th
column is the expansion coefficients $g_1$. The 11th column is $g_2$. The 12th
column is the the number to be added to $g_1$ to form the relative intensities
of level to configuration transitions for dipole transitions. The 13th column
is the number to be added to $g_2$ to form relative intensities for quadrupole
transitions.
\end{fundesc}

\begin{fundesc}{Structure}{fn, g\opt{, p\opt{, ip}}}
Diagonalize the Hamiltonian for configurations in the groups \var{g}. The
configurations in the optional groups \var{p} are allowed to interact with
\var{g} but only states within \var{g} are added to the energy level table. If
\var{ip}=0, the interaction between \var{g} and \var{p} are treated exactly,
if \var{ip}=1, this interaction is treated approximately in a way that the
non-diagonal elements within \var{p} are neglected. The energy levels are
output to the file \var{fn}.
\end{fundesc}

\begin{fundesc}{Structure}{p, j}
This is the second form of the \key{Structure} function. It distinguishes
itself from the first form because the first argument is an integer. It sets which
$\pi J$ symmetry and/or which level to include in the structure calculation. By
default, all symmetries are processed. But if this function is called with
$p=0$, or 1; $j \ge 0$ or $j$ is a list of integers, then only the specified
symmetry is processed. $j$ or integers in the list if $j$ is a list, is 
twice the actual value of the total angular momentum. The symmetry
restrictions specified here also applies to the \key{StructureMBPT} function.
\end{fundesc}

\begin{fundesc}{StructureEB}{fn, g}
Calculate the atomic structure for atom in magnetic and electric fields. The
levels belong to the configuration group \var{g} are allowed to mix in the
external fields.
\end{fundesc}

\begin{fundesc}{TransitionTable}{fn, low, up\opt{, m}}
Calculate the weighted oscillator strength and radiative transition rates from
states in \var{up} groups to states in \var{low} groups with multipole type
\var{m}. The default for \var{m} is -1, i.e., E1 transitions. The results are
saved to file \var{fn}.
\end{fundesc}

\begin{fundesc}{TRTable}{fn, low, up\opt{, m}}
Same as \key{TransitionTable}
\end{fundesc}

\begin{fundesc}{TRTableEB}{fn, lo, up\opt{, m}}
Calculate radiative transition rates between levels in external magnetic and
electric fields.
\end{fundesc}

\begin{fundesc}{WaveFuncTable}{fn, n, k\opt{, e}}
Print the radial wavefunction of the orbital with the principle quantum number
\var{n}, relativistic angular quantum number $\kappa$=\var{k} to the file
\var{fn}. If \var{n}=0, the orbital is a continuum state. In this case, the
optional \var{e} must be a positive number for the energy of the continuum
orbital in unit of eV.
\end{fundesc}



\chapter{Frequently Asked Questions (FAQ) To FAC}
\section{General}
\faq{Where can I obtain FAC}{
FAC is free software. It can be used, modified and redistributed
without restriction. Currently, it can be obtained from anonymous
\textbf{ftp://space.mit.edu/pub/mfgu/fac/}, or one may request to
\textbf{mfgu@space.mit.edu} for a copy through email.}

\faq{What operating systems does FAC run on}{
FAC is written in a mixture of ANSI C, Fortran 77, and Python, all of them are
in principle platform independent. However, the mixed language programming and
the dynamically loadable Python modules makes it more easily installed in
modern UNIX-like systems than others. So far, it has been tested to work under
Solaris, Linux, Mac OS X, and windows with the UNIX API emulation provided by
Cygwin.}
  
\faq{How does FAC differ from other atomic codes}{
The theoretical methods used in FAC are similar to some other distorted-wave
atomic codes, such as HULLAC and differ from more elaborate programs based on
close-coupling approximations, such as the Belfast R-Matrix code. The biggest
advantage of FAC is its ease of use and its scriptability.}

\faq{How does FAC differ from plasma synthetic codes}{
There are various plasma codes widely used in X-ray astronomy, such as APEC,
MEKAL, SPEX, XSTAR and Cloudy. These codes use the existing atomic data to
construct spectral models under different physical conditions. FAC is an
atomic code, whose primarily purpose is to generate atomic data, which can be
used in these plasma codes. However, FAC includes a collisional radiative
model that is able to compute spectral models for optically thin plasmas at a
given electron temperature and density. Non-Maxwellian distribution of electron
energy may be easily implemented as well. A power law ionizing continuum
radiation may also be included.}

\faq{Can FAC be incorporated into XSPEC or other spectral analysis programs}{
In principle, the collisional radiative model comes with FAC can be used in
XSPEC or similar spectral analysis programs. However, this is not practical,
as the model includes a large number of atomic states, especially, the doubly
excited states to treat the resonant processes, and is therefore very time
consuming. The best strategy of incorporating the FAC results to external
spectral models is to extract basic atomic or plasma parameters and use them
to build table models or implement dedicated subroutines.}

\faq{Which atomic processes can or cannot be calculated with FAC}{
FAC can calculate energy levels, radiative transition rates of arbitrary
multipole type, collisional excitation and ionization cross sections by
electron impact, photoionization and radiative recombination cross sections and
autoionization rates. In the current form, FAC does not treat two-photon
decay, although such decay rates of $2s S_{1/2}$ state of H-like ions and
$1s2s S_{0}$ state of He-like ions are included in the collisional radiative
model using interpolation formulae taken from literature. The three-body
recombination are not implemented as well.}

\faq{What is a typical accuracy of the atomic parameters calculated with
FAC}{
The ions other than H-like, the accuracy of energy levels are usually a few
eV, which translates to 10--30 m{\AA} for the wavelength at $\sim$10{\AA}. For
radiative transition rates and cross sections, the accuracy is
$\sim$10--20\%. Data for near-neutral ions or atoms may have even larger
errors.}

\faq{Can FAC be used to calculate atomic parameters for non-X-ray (UV,
optical, etc.) lines}{
For multiply-charged ions, non-X-ray lines usually result from the transitions
within the same complex, which usually have large relative uncertainties in
the calculated wavelengths and transition rates. The accuracy for UV and
optical lines from near-neutral ions is also very limited.}

\faq{Are there standard references to FAC}{
Currently, no papers have been published describing the code, though
drafts have been written, which are included in the FAC distribution. I have
been trying to find a suitable journal willing to publish
them. I originally submitted them to Computer Physics Communications
(CPC). However, the referee and editor complained about the lack of
documentation and code comments. The documentation has improved since
then, the code commenting still needs extensive work, which may not be done
soon. The first paper that used results of FAC is Gu, M.F., 2003, ApJ, 582,
1241, which can be used as the reference.}

\faq{How do I report bugs, make suggestions and get updated about new
versions}{
Please contact the author at \textbf{mfgu@space.mit.edu} for bugs and
suggestions. I maintain a small email address list of people who expressed
interest in FAC and send release announcements to them. Let me know if you want
to be added to this list. If the list ever grows to the point when I can no
longer put it under my personal address book, we may have to create a
dedicated mailing list.}

\section{Atomic Structure}
\faq{How do I specify a bare ion}{
The bare ion is indicated by a call to \key{Config('', group='b')}, i.e.,
the first argument of \key{Config} is an empty string.}

\faq{Which configurations should be used as basis for the mean configuration
which optimizes the radial potential}{
The function \key{OptimizeRadial} accepts a list of configurations, which
form the basis for the construction of the mean configuration. Usually, only
the lowest lying configurations should be used in \key{OptimizeRadial} for
the construction of mean configuration. I have found that using configurations
corresponding to the ground complex is always a good idea. Sometimes, it maybe
worthwhile to include the first excited configurations. However, it is always a
bad practice to include very highly excited configurations, especially those
inner shell excited ones.}

\faq{Can I use a specific mean configuration to be used in potential
optimization}{
The function \key{AvgConfig} may be used to set the mean configuration for
the potential optimization. In this case, the function
\key{OptimizeRadial} must be called with no arguments.}

\faq{How do I know what mean configuration is used in the potential
optimization, If one is not given specifically by \key{AvgConfig}}{
The function \key{GetPotential} may be called after \key{OptimizeRadial}
to obtain the mean configuration used, and the resulting radial potential.}

\faq{When calculating ionization or recombination processes, should I use the
mean configuration for recombined (ionizing) or recombining (ionized) ion}{
Usually, it does not matter for highly charged ions, and I usually use the 
recombined ion. The difference of one more or less electron screening the
nuclear charge may be substantial for low-$Z$ elements, in which case, one
may have to make a decision by comparing the results to experimental values or
other theoretical works.}

\faq{How do I determine which configurations should be interacting}{
This depends on the computer resource available, and the desired accuracy. The
dimension of the Hamiltonian matrix increases very rapidly as the number of
interacting configurations grows. The convergence with respect to the
configuration interaction is usually slow. For applications which FAC is
primarily designed for, one typically includes only configurations within the
same complex, except for some low-lying configurations.}

\faq{What relativistic effects are included}{
The standard Dirac-Coulomb Hamiltonian is used in FAC, which means that the
spin-orbit interaction, mass-effect and other leading relativistic effects are
fully treated. However, higher-order QED effects, such as retardation and
recoil are only included in the Breit interaction with zero energy limit for
the exchanged photon. Vacuum polarization and self-energy corrections are
treated in the screened hydrogenic approximation.}

\faq{Why the transition rate between two specific states is not in the output
file, although it should have been calculated}{
Not every calculated transition rate are output. Some weak transitions are
discarded to avoid very large files. A small number, which may be set by the
function \key{SetTransitionCut}, controls this behavior. If the
transition rate of $2\to 1$ divided by the total decay rate of state 2 is less
than this number, this rate is not output. The default for this number is
$10^{-4}$.}

\section{Collisional Excitation}
\faq{Why is there multiple data blocks in the output corresponding to a single
call of \key{CETable} sometimes}{
Sometimes, the transition array corresponding to a given call to \key{CETable}
include transitions with a wide range of excitation energies. This typically
happens for transitions within a single complex or transitions between more
than 2 complexes are mixed together in one call of \key{CETable} (which should
generally be avoided). Since the excitation radial integrals are only
calculated on a few-point transition energy grid, it is undesirable to have a
very wide range in the actual transition energies. \key{CETable} avoid this by
subdivide the transitions in groups. Within each group, the transition
energies does not vary by more than a factor of 5. A different transition
energy grid and collision energy grid are used for different groups, and
therefore, corresponding to different data blocks in the output.}

\faq{Why is the default \key{QKMODE} for excitation is \key{EXACT}, not
\key{FIT}}{
It used to be in \key{FIT} mode. However, the fitting formulae sometimes fail
to reproduce the calculated collision strengths. After playing with different
fitting formulae for a while, I decided that the user should do the fitting
(if one is desired) on the case by case basis. The function \key{SetCEQkMode}
may be used to specify a different \key{QKMODE}.}

\faq{Can I use a different collision energy grid}{
A collision energy grid in terms of the energy of the scattered electron is
automatically constructed if one is not specified prior to calling
\key{CETable}. One may use the function \key{SetCEGrid} to specify a different
grid. Or one may use \key{SetUsrCEGrid} to have a user grid different from the
grid on which the collision strengths are calculated, and use
\key{INTERPOLATE} mode for the \key{QKMODE}.}

\faq{The collision strengths at very high energies are incorrect}{
Due to the limited radial grid size, the collision strengths at energies much
higher than the excitation energy (more than a few hundred times higher) are
unlikely to be reliable. However, the high energy collision strengths should
not be calculated directly. The Bethe and Born limit parameters in the output
should be used to obtain them.}

\section{Photoionization and Radiative Recombination}
\faq{When can I use the function \key{RecStates} to construct the
recombined states instead of specifying their configurations by \key{Config}}{
The function \key{RecStates} can only be used if the free electron is captured
to an empty orbital.}

\faq{Why is the bound-free oscillator strength differ from some other
theoretical calculation by a constant factor}{
The bound-free differential oscillator strengths calculated by FAC have units
of Hartree$^{-1}$. Also the values depend on the normalization of continuum
orbitals. It is therefore possible that they differ from other theoretical
calculations by a constant factor. One should always use the formula in this
manual or the accompanying papers to convert them to photoionization or
radiative recombination cross sections.}

\faq{Can I use only the fitting formula and ignore the tabulated $gf$
values}{
The fitting formula and the parameters given for the bound-free oscillator
strengths is only valid at high energies (beyond the largest energy of the
photo-electron energy grid). This means that the $gf$ values at energies
within the photo-electron energy grid should be calculated by interpolation
instead of the fitting formula. However, this is often only necessary for the
ionization of valence shells of near neutral ions and atoms, since only in
these cases, the near threshold behavior of the $gf$ values differ from the
fitting formula significantly.}

\section{Autoionization and Dielectronic Recombination}{
\faq{What does the channel number in the call to \key{AITable} mean}{
It does not mean anything. It is simply an identifier which may be useful
sometimes to tag a certain autoionization channel.}

\faq{How do I improve the resonance energies of low-lying $\Delta n = 0$
resonances}{
The energies of low-lying $\Delta n = 0$ resonances can not the calculated
accurately. This greatly reduces the reliability of the resulting dielectronic
recombination rates. In FAC, there is a method to improve the accuracy of
these energies by adjusting the core transition energies according to the
experimental values. The function \key{CorrectEnergy} is used to modify the
calculated energy levels by specified amount.}

\faq{Why is it advised to make separate calls to \key{AITable} for different
bound or free state complexes}{
The autoionization radial integrals are only calculated for a few free
electron energies. The actual values are interpolated from them. This only
works well if the the free electron energy after autoionization does not vary
widely. Therefore, one should avoid calling \key{AITable} with bound or free
states in different complexes. e.g., KLL and KLM resonances should be
calculated with two separate calls to \key{AITable}.}

\section{Collisional Ionization}
\faq{Why are FAC ionization cross sections calculated with \key{BED} mode
usually much smaller at near threshold energies as compared with
distorted-wave calculations}{
When using \key{BED} mode to calculate the ionization radial integrals, the
total ionization cross sections are scaled by a factor $E/(E+I)$, where $E$ is
the energy of incident electron, and $I$ is the ionization threshold
energy. The result of this scaling is usually desirable as distorted-wave
method overestimates the near threshold cross sections.}

\faq{Why is the \key{DW} mode so slow as compared with \key{BED} and \key{CB}
modes}{
In the \key{DW} mode, the ionization radial integrals are calculated by
summing up partial wave contributions. This is a time consuming process as
now there are two continuum electrons involved. In the \key{CB} mode, the
radial integrals are simply looked up in a table, is therefore the fastest
method. In the \key{BED} mode, the radial integrals are calculated using the
bound-free differential oscillator strengths, which can be computed much
faster than the \key{DW} ionization radial integrals.}

\bibliographystyle{plainnat}
\bibliography{facref}

\printindex
\end{document}
